<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 10.1.4" />
<title>CommonAPI C++ User Guide</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overridden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>CommonAPI C++ User Guide</h1>
<span id="revdate">13. 5月 2022</span>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_aim_of_this_document">Aim of this document</h3>
<div class="paragraph"><p>This user guide has the following content:</p></div>
<div class="ulist"><ul>
<li>
<p>
installation instructions for CommonAPI in general including the code generator (CommonAPI Tools)
</p>
</li>
<li>
<p>
a step by step tutorial on how you can write your first Hello World program
</p>
</li>
<li>
<p>
examples for a deeper insight into the usage of CommonAPI in conjunction with Franca IDL
</p>
</li>
<li>
<p>
additional information to CommonAPI which is not part of the CommonAPI specification
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_commonapi_c">CommonAPI C++</h3>
<div class="paragraph"><p>CommonAPI C++ is a standardized C++ API specification for the development of distributed applications which communicate via a middleware for interprocess communication. The main intention is to make the C++ interface for applications independent from the underlying IPC stack. The basic principle can be seen in the following picture.</p></div>
<div class="imageblock">
<div class="content">
<img src="../images/CommonAPIOverview01.png" alt="CommonAPI C++ Overview 1 image" />
</div>
<div class="title">Figure 1. CommonAPI C++ Overview 1</div>
</div>
<div class="ulist"><ul>
<li>
<p>
CommonAPI C++ is divided up in a middleware-independent part (CommonAPI Core) and in a middleware-specific part (CommonAPI Binding).
</p>
</li>
<li>
<p>
CommonAPI uses the interface description language FrancaIDL for the specification of interfaces (logical interface specification). Code generation from FrancaIDL is an integrated part of CommonAPI.
</p>
</li>
<li>
<p>
The code generator for CommonAPI C++ bindings needs middleware-specific parameters (deployment parameters). These parameters are defined in Franca deployment files (*.fdepl).
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="../images/icons/note.png" alt="Note" />
</td>
<td class="content">CommonAPI C++ Core has no obligatory deployment parameters. But it turned out that it makes sense to add also additional deployment parameter to CommonAPI C++ Core itself.</td>
</tr></table>
</div>
<div class="paragraph"><p>The user API of CommonAPI is divided up into two parts (see picture below):</p></div>
<div class="ulist"><ul>
<li>
<p>
A FrancaIDL based, generated part which contains API functions that are related to the types, attributes and methods of the FrancaIDL files.
</p>
</li>
<li>
<p>
A "common" part (Runtime API) which contains API functions for loading the runtime environment, creating proxies and so on.
</p>
</li>
</ul></div>
<div class="imageblock">
<div class="content">
<img src="../images/CommonAPIOverview02.png" alt="CommonAPI C++ Overview 2 image" />
</div>
<div class="title">Figure 2. CommonAPI C++ Overview 2</div>
</div>
<div class="paragraph"><p>This picture shows in more detail how the elements of CommonAPI C++ fit together. Note that:</p></div>
<div class="ulist"><ul>
<li>
<p>
the vast majority of the user API is the generated part of CommonAPI.
</p>
</li>
<li>
<p>
there is no direct relation between CommonAPI Core and the IPC stack.
</p>
</li>
<li>
<p>
the generated code of the CommonAPI Binding has interfaces to all other parts of CommonAPI.
</p>
</li>
</ul></div>
<div class="paragraph"><p>The workflow for developers of applications is as follows:</p></div>
<div class="ulist"><ul>
<li>
<p>
Create a FrancaIDL file with the specification of an interface with methods and attributes.
</p>
</li>
<li>
<p>
Generate code for client and service by starting the CommonAPI code generator.
</p>
</li>
<li>
<p>
Implement the service by implementing the methods in the generated skeleton.
</p>
</li>
<li>
<p>
Implement the client by creating proxies and calling these methods by using the proxy.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_links">Links</h3>
<div class="paragraph"><p>CommonAPI is a GENIVI project. Source code and latest news can be found at <a href="http://projects.genivi.org/commonapi/">http://projects.genivi.org/commonapi/</a>. Source code can be found in the Git repository (<a href="http://git.projects.genivi.org/">http://git.projects.genivi.org/</a>). For documentation please visit the GENIVI document page <a href="http://docs.projects.genivi.org/">http://docs.projects.genivi.org/</a>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="../images/icons/note.png" alt="Note" />
</td>
<td class="content">At <a href="http://git.projects.genivi.org/">http://git.projects.genivi.org/</a> you will find only source code even for the code generator. It might be cumbersome to build the code generator of your own; for your convenience you will find executables and update-sites at <a href="http://docs.projects.genivi.org/yamaica-update-site/">http://docs.projects.genivi.org/yamaica-update-site/</a>.</td>
</tr></table>
</div>
<div class="paragraph"><p>Closely related to CommonAPI is the yamaica project which provides a full integration of all Franca IDL and CommonAPI plugins and some more enhanced features like the import and export of Franca files to Enterprise Architect. The yamaica project provides eclipse update-sites for CommonAPI and yamaica (see <a href="http://docs.projects.genivi.org/yamaica-update-site/">http://docs.projects.genivi.org/yamaica-update-site/</a>) ready for installation.</p></div>
<div class="paragraph"><p>The official FrancaIDL site is at the moment: <a href="https://code.google.com/a/eclipselabs.org/p/franca/">https://code.google.com/a/eclipselabs.org/p/franca/</a></p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_integration_guide_for_commonapi_users">Integration Guide for CommonAPI users</h2>
<div class="sectionbody">
<div class="paragraph"><p>The following descriptions assume that host and target platform are Linux platforms. However CommonAPI supports also Windows as host and target platform. All you need to know for Windows concerning CommonAPI you find in the separate Windows paragraph below at the end of this Integration Guide.</p></div>
<div class="sect2">
<h3 id="_requirements">Requirements</h3>
<div class="paragraph"><p>CommonAPI was developed for GENIVI and will run on most Linux platforms. Additionally it is possible to run it under Windows for test and development purposes. Please note:</p></div>
<div class="ulist"><ul>
<li>
<p>
CommonAPI uses a lot of C++11 features, as variadic templates, std::bind, std::function and so on. Make sure that the compiler of your target platform is able to compile it (e.g. gcc 4.8).
</p>
</li>
<li>
<p>
The build system of CommonAPI is CMake; please make sure that it is installed on your host. CommonAPI requires a CMake version &gt; 2.8.12.
</p>
</li>
<li>
<p>
This user guide describes only the "common" CommonAPI part; there are no binding specific explanations. Please refer to the binding specific user guide for further information.
</p>
</li>
<li>
<p>
Do not use earlier versions of Eclipse as Luna; it could work but there is no warranty.
</p>
</li>
<li>
<p>
The build tool chain for the code generators is Maven; make sure that at least Maven 3 is available. If you use eclipse make sure that the maven plug-in is installed.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_dependencies">Dependencies</h3>
<div class="imageblock">
<div class="content">
<img src="../images/CommonAPI-Dependencies.png" alt="CommonAPI Dependencies" />
</div>
<div class="title">Figure 3. CommonAPI-Dependencies</div>
</div>
</div>
<div class="sect2">
<h3 id="_compile_runtime">Compile Runtime</h3>
<div class="sect3">
<h4 id="_command_line">Command-line</h4>
<div class="paragraph"><p>For building CommonAPI from the command-line download the Common API runtime via Git from the GENIVI Git repository, switch to the desired tag (e.g. 3.0.0) and compile it using CMake:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ git clone git://git.projects.genivi.org/ipc/common-api-runtime.git
$ cd common-api-runtime
$ git checkout tags/3.0.0
$ mkdir build
$ cd build
$ cmake ..
$ make</code></pre>
</div></div>
<div class="paragraph"><p>This is the standard procedure and will hopefully create the shared CommonAPI runtime library libCommonAPI.so in <em>build/src/CommonAPI</em>. Note that CMake checks if doxygen and asciidoc are installed. These tools are only necessary if you want to generate the documentation of your own. The unit tests of CommonAPI are implemented by using the Google C++ Testing Framework. If you want to build and run the unit tests the environment variable <code>GTEST_ROOT</code> must point to the correct directory (see the contributor&#8217;s guide below).</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="../images/icons/note.png" alt="Note" />
</td>
<td class="content">If you prefer to install CommonAPI from a tar file you can get the actual tar file from:
    <a href="http://docs.projects.genivi.org/yamaica-update-site/CommonAPI/runtime/">http://docs.projects.genivi.org/yamaica-update-site/CommonAPI/runtime/</a></td>
</tr></table>
</div>
<div class="paragraph"><p>There are several options for calling CMake and make targets.</p></div>
<div class="paragraph"><p>Generate makefile for building a static CommonAPI library (default is a shared library). The library will be in <em>/build/src/CommonAPI</em>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ cmake -DBUILD_SHARED_LIBS=OFF ..</code></pre>
</div></div>
<div class="paragraph"><p>Generate makefile for building the release version of CommonAPI (default is debug).</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ cmake -DCMAKE_BUILD_TYPE=Release ..</code></pre>
</div></div>
<div class="paragraph"><p>Without any further settings <code>make install</code> will copy CommonAPI libraries and header files to <em>/usr/local</em>. You can change this destination directory by changing the installation prefix (e.g. to test).</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ cmake -DCMAKE_INSTALL_PREFIX=/test  ..</code></pre>
</div></div>
<div class="paragraph"><p>Additional cmake parameters:</p></div>
<div class="tableblock">
<table rules="all"
width="90%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="37%" />
<col width="31%" />
<col width="31%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>-DUSE_INSTALLED_COMMONAPI</code></p></td>
<td align="left" valign="top"><p class="table">OFF, ON</p></td>
<td align="left" valign="top"><p class="table">use uninstalled / installed CommonAPI core library</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-DMAX_LOG_LEVEL</code></p></td>
<td align="left" valign="top"><p class="table">ERROR, WARNING, INFO, DEBUG, VERBOSE</p></td>
<td align="left" valign="top"><p class="table">log messages with lower log level are ignored</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Make targets:</p></div>
<div class="tableblock">
<table rules="all"
width="90%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="28%" />
<col width="71%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>make all</code></p></td>
<td align="left" valign="top"><p class="table">Same as make. Will compile and link CommonAPI.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>make clean</code></p></td>
<td align="left" valign="top"><p class="table">Deletes binaries, but not the files which has been generated by CMake.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>make maintainer-clean</code></p></td>
<td align="left" valign="top"><p class="table">Deletes everything in the build directory.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>make install</code></p></td>
<td align="left" valign="top"><p class="table">Copies libraries to <em>/user/local/lib/commonapiX.X.X</em> and header files to <em>/user/local/include/commonapiX.X.X/CommonAPI</em>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>make DESTDIR=&lt; install_dir &gt; install</code></p></td>
<td align="left" valign="top"><p class="table">The destination directory for the installation can be influenced by <code>DESTDIR</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Further make targets will be described in the contributor&#8217;s guide below.</p></div>
</div>
<div class="sect3">
<h4 id="_eclipse">Eclipse</h4>
<div class="paragraph"><p>Start with importing your project by <em>File&#8594;New&#8594;Makefile Project with Existing Code</em>. Select your project directory and <em>Linux GCC</em>.</p></div>
<div class="paragraph"><p>If not yet available, create a <code>Make Target</code> (e.g. with the name <code>Run cmake</code>) and edit it. Set the "<code>Build command:</code>" to:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>cmake -E chdir build/ cmake -G "Unix Makefiles" ../</code></pre>
</div></div>
<div class="paragraph"><p>and delete the "<code>Make target:</code>" field and let it empty.</p></div>
<div class="paragraph"><p></p></div>
<div class="imageblock">
<div class="content">
<img src="../images/EclipseCommonAPISettings01.png" alt="CommonAPI C++ Eclipse Settings 01 image" />
</div>
<div class="title">Figure 4. CommonAPI C++ Eclipse Settings 01</div>
</div>
<div class="paragraph"><p>Create the <code>build</code> directory directly in your project directory.</p></div>
<div class="paragraph"><p>Then you can start <code>Build target</code> in the context menu of your <code>Make target</code> and then build the project by <em>Project&#8594;Build Project</em>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_compile_tools">Compile tools</h3>
<div class="paragraph"><p>An executable version of the command-line version of the CommonAPI code generator is available for Linux (32 bit) as zip-file. An update-site for installing the code generators in eclipse is also available (see below). The following instructions are for the case that you have to build the code generator yourself.</p></div>
<div class="sect3">
<h4 id="_command_line_2">Command-line</h4>
<div class="paragraph"><p>You can build all code generators by calling maven from the command-line. Open a console and change in the directory org.genivi.commonapi.core.releng of your CommonAPI-Tools directory. Then call:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>mvn -Dtarget.id=org.genivi.commonapi.core.target clean verify</code></pre>
</div></div>
<div class="paragraph"><p>After the successful build you will find the commond-line generators archived in
<em>org.genivi.commonapi.core.cli.product/target/products/commonapi-generator.zip</em> and the update-sites in org.genivi.commonapi.core.updatesite/target.</p></div>
</div>
<div class="sect3">
<h4 id="_eclipse_2">Eclipse</h4>
<div class="paragraph"><p>Make sure that you have installed the <em>m2e - Maven Integration for Eclipse</em> plug-in. Then create a <em>Run Configuration</em> in Eclipse. Open the <em>Run configuration</em> settings. On the left side of you should find a launch configuration category <em>Maven Build</em>. Create a new launch configuration and add the parameter <code>target.id</code> with the value <code>org.genivi.commonapi.core.target</code>. Set the <em>Goals</em> to <em>clean verify</em>.</p></div>
<div class="imageblock">
<div class="content">
<img src="../images/EclipseBuildToolsSettings.png" alt="CommonAPI C++ Eclipse Build Tools Settings image" />
</div>
<div class="title">Figure 5. CommonAPI C++ Eclipse Build Tools Settings</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_write_applications">Write Applications</h3>
<div class="paragraph"><p>CommonAPI requires a basic workflow for creating executable applications.</p></div>
<div class="imageblock">
<div class="content">
<img src="../images/CommonAPIWorkflow.png" alt="CommonAPI C++ Workflow image" />
</div>
<div class="title">Figure 6. CommonAPI C++ Workflow</div>
</div>
<div class="sect3">
<h4 id="_generating_code">Generating Code</h4>
<div class="paragraph"><p>No matter which development environment is used, the API for the applications is created by the CommonAPI code generator which is available as command-line version and as Eclipse update-site.</p></div>
<div class="paragraph"><p>The simplest way to use the CommonAPI Tools is to add the update-site available on the GENIVI project servers to your Eclipse. Add the update site in Eclipse by calling <em>Help&#8594;Install New Software&#8594;Add</em>. Enter the URL: <a href="http://docs.projects.genivi.org/yamaica-update-site/CommonAPI/updatesite/">http://docs.projects.genivi.org/yamaica-update-site/CommonAPI/updatesite/</a> and confirm.</p></div>
<div class="paragraph"><p>Then select the newly added site in the site selection dropdown box, and in the Software selection window, select the entire "GENIVI Common API" Tree.</p></div>
<div class="paragraph"><p>After the software has been installed in Eclipse you can right-click on any <code>.fidl</code> or <code>.fdepl</code> file and generate C++ code for CommonAPI by selecting the <em>CommonAPI&#8594;Generate Common API Code</em> option.</p></div>
<div class="paragraph"><p>If you have built the update-site of your own, you can add the site as well; just add it as archive.</p></div>
<div class="paragraph"><p>An executable version of the command-line version of the CommonAPI code generator is available only for Linux (32 bit) as zip-file at <a href="http://docs.projects.genivi.org/yamaica-update-site/CommonAPI/generator">http://docs.projects.genivi.org/yamaica-update-site/CommonAPI/generator</a>. Download the zip-file and unzip it to an appropriate directory. Then it is ready for use.</p></div>
<div class="paragraph"><p>Call the executable <code>commonapi_generator</code> as follows:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>commonapi_generator [options] file [file...]</code></pre>
</div></div>
<div class="paragraph"><p>Valid Options are:</p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>-dest &lt; path/to/output/folder &gt;</code></p></td>
<td align="left" valign="top"><p class="table">The generated files will be saved at this Location.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-pref &lt; path/to/header/file &gt;</code></p></td>
<td align="left" valign="top"><p class="table">Here you can set the text which will be placed as a comment on each generated file (for example your license).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="../images/icons/note.png" alt="Note" />
</td>
<td class="content">If your CommonAPI binding requires deployment files the input for the code generator is the appropriate deployment file which imports the Franca file. For some bindings (e.g. D-Bus) and deployment file is not obligatory; in this case it is also possible to start the code generator with fidl-files as input.</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="_build_applications">Build Applications</h4>
<div class="paragraph"><p>Your application should compile and link only with the generated CommonAPI code and the CommonAPI runtime library. For a fast setup please consider the provided examples in CommonAPI-Tools/CommonAPI-Examples.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_project_setup">Project Setup</h3>
<div class="sect3">
<h4 id="_structuring_commonapi_project_libraries">Structuring CommonAPI project libraries</h4>
<div class="paragraph"><p>CommonAPI executables typically consist of 6 parts:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
The application code itself which is written manually by the developer.
</p>
</li>
<li>
<p>
The generated CommonAPI (binding independent) code. In clients this code contains proxy functions which are called by the application; in services it contains generated functions which must be manually implemented by the developer (optionally it is possible to generate default implementations).
</p>
</li>
<li>
<p>
The CommonAPI runtime library.
</p>
</li>
<li>
<p>
The generated, binding specific code (so-called glue code).
</p>
</li>
<li>
<p>
The runtime library of the binding.
</p>
</li>
<li>
<p>
Generic libraries of the used middleware (e.g. <code>libdbus</code>).
</p>
</li>
</ol></div>
<div class="paragraph"><p>Even if there are several possibilities to divide these 6 parts up into shared or static libraries and to integrate them on a target platform, there is a standard way which is intended for the integration of CommonAPI applications (see picture below).</p></div>
<div class="imageblock">
<div class="content">
<img src="../images/CommonAPIStructuringLibraries.png" alt="CommonAPI C++ Structuring Libraries image" />
</div>
<div class="title">Figure 7. CommonAPI C++ Structuring Libraries</div>
</div>
<div class="paragraph"><p>The standard way assumes that there is a platform software which provides necessary standard libraries in a suitable version. For CommonAPI these are the runtime libraries of CommonAPI itself, bindings and the associated middleware. Furthermore the platform should provide binding specific libraries which contain generated binding specific code (glue code). The glue code can be divided up into several shared libraries depending on used bindings, number of interfaces and other platform and project specific requirements. The application can now be delivered together with the generated binding independent code which can be statically or dynamically linked.</p></div>
<div class="paragraph"><p>The glue code library will now be loaded at the exact moment in which a proxy is created. The right library will be found by the evaluation of the CommonAPI configuration file that contains the association between CommonAPI address and the glue code library. In the case that there are no entries in the configuration file, default settings are used.</p></div>
<div class="paragraph"><p>The glue code library is binding specific; that means that the required runtime libraries are loaded automatically by the runtime linker. In the case that a certain instantiated interface in a service is offered via another middleware as before, it is sufficient just to change the entries in the configuration file, provided that a generated glue code library is available.</p></div>
</div>
<div class="sect3">
<h4 id="_write_commonapi_configuration_files">Write CommonAPI Configuration Files</h4>
<div class="paragraph"><p>CommonAPI and available bindings can be configured by ini-files (see e.g. <a href="http://en.wikipedia.org/wiki/INI_file">http://en.wikipedia.org/wiki/INI_file</a>).</p></div>
<div class="paragraph"><p>The CommonAPI configuration file is <code>commonapi.ini</code>. There are three places where CommonAPI Runtime tries to find this file (in the following order):</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
in the directory of the current executable. If there is a <code>commonapi.ini</code> file, it has the highest priority.
</p>
</li>
<li>
<p>
in the directory which is specified by the environment variable <code>COMMONAPI_CONFIG</code>.
</p>
</li>
<li>
<p>
in the global default directory <code>/etc</code>.
</p>
</li>
</ol></div>
<div class="paragraph"><p>The configuration file has 4 possible sections; all sections are optional.</p></div>
<div class="sect4">
<h5 id="_code_logging_code"><code>logging</code></h5>
<div class="paragraph"><p>CommonAPI has an internal logging mechanism which can be parameterized by the settings of this section:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>console=true/false</code>
</p>
</li>
<li>
<p>
<code>file=</code> <em>&lt;file name&gt;</em>
</p>
</li>
<li>
<p>
<code>dlt=true/false</code>
</p>
</li>
<li>
<p>
<code>level=fatal/error/warning/info/debug/verbose</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[logging]
console=true
file=./mylog.log
dlt=true
level=verbose</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="../images/icons/note.png" alt="Note" />
</td>
<td class="content">If the configured log level is higher than the maximum log level that was defined at compile time, the maximum log level will be used.</td>
</tr></table>
</div>
</div>
<div class="sect4">
<h5 id="_code_default_code"><code>default</code></h5>
<div class="paragraph"><p>Section for setting the default value for the used binding and optionally change the 5 seconds default call-timeouts while leaving the timeout of custom calls.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>binding=dbus/someip</code>
</p>
</li>
<li>
<p>
<code>callTimeout=</code> <em>&lt;timeout in ms&gt;</em>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[default]
binding=dbus
callTimeout=3000</code></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_code_proxy_code"><code>proxy</code></h5>
<div class="paragraph"><p>This section defines for each required CommonAPI address the shared library with the binding specific, generated glue code which has to be loaded when the proxy is created.</p></div>
<div class="ulist"><ul>
<li>
<p>
<em>&lt;CommonAPI address&gt;</em>=<em>&lt;library name&gt;</em>
</p>
</li>
</ul></div>
<div class="paragraph"><p>If no library is defined, CommonAPI uses default settings for library names and paths; for further information see chapter <em>Creating Proxies And Stubs</em>.</p></div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[proxy]
local:commonapi.examples.Test:commonapi.examples.Test=libTest-DBus.so</code></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_code_stub_code"><code>stub</code></h5>
<div class="paragraph"><p>Analogous to the proxy section.</p></div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[stub]
local:commonapi.examples.Test:commonapi.examples.Test=libTest-DBus.so</code></pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_commonapi_deployment">CommonAPI Deployment</h4>
<div class="paragraph"><p>The CommonAPI code generator supports nearly the full feature set of Franca IDL and works without any deployment file. However it is possible to write deployment files for interface specifications not only for bindings but also for CommonAPI itself based on the following deployment specification.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">specification</span> org<span style="color: #990000">.</span>genivi<span style="color: #990000">.</span>commonapi<span style="color: #990000">.</span>core<span style="color: #990000">.</span>deployment <span style="color: #FF0000">{</span>

    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> interfaces <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">/*</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         * define the enumeration backing type on CommonAPI C++ level for whole interface.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         */</span></span>
        DefaultEnumBackingType <span style="color: #990000">:</span> <span style="color: #FF0000">{</span>UInt8<span style="color: #990000">,</span> UInt16<span style="color: #990000">,</span> UInt32<span style="color: #990000">,</span> UInt64<span style="color: #990000">,</span> Int8<span style="color: #990000">,</span> Int16<span style="color: #990000">,</span> Int32<span style="color: #990000">,</span> Int64<span style="color: #FF0000">}</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">default</span></span><span style="color: #990000">:</span> UInt8<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> providers <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">/*</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         * Enumerate all service instances this provider depends on (if any).</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         */</span></span>
        ClientInstanceReferences <span style="color: #990000">:</span> Instance<span style="color: #990000">[]</span> <span style="color: #990000">(</span>optional<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> instances <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">/*</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         * The CommonAPI address string has the format "domain:interfaceid:instanceid"</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         * according to CommonAPI specification.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         * To avoid inconsistencies only domain and instance id can be specified during deployment,</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         * while the interface id is fixed by the interface the instance realizes.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         */</span></span>
        Domain <span style="color: #990000">:</span>     <span style="font-weight: bold"><span style="color: #000000">String</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">default</span></span><span style="color: #990000">:</span> <span style="color: #FF0000">"local"</span><span style="color: #990000">);</span> <span style="font-style: italic"><span style="color: #9A1900">// the domain part of the CommonAPI address.</span></span>
        InstanceId <span style="color: #990000">:</span> String<span style="color: #990000">;</span>                     <span style="font-style: italic"><span style="color: #9A1900">// the instance id of the CommonAPI address.</span></span>

        <span style="font-style: italic"><span style="color: #9A1900">/*</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         * Define default timeout for all methods awaiting results of an instance in seconds.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         * 0s means no timeout/waiting forever.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         * if the timeout elapsed without arrival of a valid result an error will be delivered to the application.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         */</span></span>
        DefaultMethodTimeout <span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #000000">Integer</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">default</span></span><span style="color: #990000">:</span><span style="color: #993399">0</span><span style="color: #990000">);</span>

        <span style="font-style: italic"><span style="color: #9A1900">/*</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         * provide properties to register for instance. use "Name=Value" as format.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         * This deployment property is currently not supported.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         */</span></span>
        PreregisteredProperties <span style="color: #990000">:</span> String <span style="color: #990000">[]</span> <span style="color: #990000">(</span>optional<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> methods <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">/*</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         * timeout for method calls in ns.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         * If timeout is defined with value &gt; 0, then a method call will return with a timeout error</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         * in case no result arrived before the timeout elapsed.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         * 0 means no timeout.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         */</span></span>
        Timeout <span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #000000">Integer</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">default</span></span><span style="color: #990000">:</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> enumerations <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">/*</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         * define the enumeration backing type on CommonAPI C++ level for a specific enumeration.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         * If not specified use "ApiDefaultEnumBackingType".</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         */</span></span>
        EnumBackingType <span style="color: #990000">:</span> <span style="color: #FF0000">{</span>UInt8<span style="color: #990000">,</span> UInt16<span style="color: #990000">,</span> UInt32<span style="color: #990000">,</span> UInt64<span style="color: #990000">,</span> Int8<span style="color: #990000">,</span> Int16<span style="color: #990000">,</span> Int32<span style="color: #990000">,</span> Int64<span style="color: #FF0000">}</span> <span style="color: #990000">(</span>optional<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The enumeration backing type can be set on CommonAPI C++ level not only specific for single enumerations but also generally for the whole interface. Please note that bindings might also have deployment settings which concern the backing type of enumerations.</p></div>
<div class="paragraph"><p>It is also possible to define timeouts for function calls. Another possibility to set this timeout is to define it in the optional <code>CallInfo</code> parameter of the method call.</p></div>
<div class="paragraph"><p>The settings for instances and providers are not evaluated by the code generator.</p></div>
<div class="paragraph"><p>See the following example for the usage of the deployment parameters. The Franca specification is:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">package</span></span> commonapi<span style="color: #990000">.</span>examples

<span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">Example</span> <span style="color: #FF0000">{</span>

    version <span style="color: #FF0000">{</span> major <span style="color: #993399">0</span>  minor <span style="color: #993399">1</span> <span style="color: #FF0000">}</span>

    <span style="color: #008080">method</span> test <span style="color: #FF0000">{</span>
        in <span style="color: #FF0000">{</span>
            EN x
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>

    <span style="color: #008080">enumeration</span> EN <span style="color: #FF0000">{</span>
        DEFAULT
        NEW
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Possible deployment settings could look like:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> <span style="color: #FF0000">"CommonAPI-4_deployment_spec.fdepl"</span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> <span style="color: #FF0000">"Example.fidl"</span>

<span style="color: #008080">define</span> org<span style="color: #990000">.</span>genivi<span style="color: #990000">.</span>commonapi<span style="color: #990000">.</span>core<span style="color: #990000">.</span>deployment <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">commonapi</span><span style="color: #990000">.</span>examples<span style="color: #990000">.</span>Example <span style="color: #FF0000">{</span>

    DefaultEnumBackingType <span style="color: #990000">=</span> UInt8

    <span style="color: #008080">method</span> test <span style="color: #FF0000">{</span>
        Timeout <span style="color: #990000">=</span> <span style="color: #993399">1</span>
    <span style="color: #FF0000">}</span>

    <span style="color: #008080">enumeration</span> EN <span style="color: #FF0000">{</span>
        EnumBackingType <span style="color: #990000">=</span> UInt64
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_commonapi_logging">CommonAPI Logging</h4>
<div class="paragraph"><p>CommonAPI Runtime informs about internal errors, warnings and other events by means of the CommonAPI Logger. Please refer to the chapter <em>Write CommonAPI Configuration Files</em> if you want to know in general how it is possible to get CommonAPI log messages.</p></div>
<div class="paragraph"><p>CommonAPI supports the DLT standard. To get DLT log messages make sure that DLT is installed when running <em>CMake</em>. If <em>CMake</em> finds the DLT library the compiler switch <code>-DUSE_DLT</code> is set. Additionally set the key <code>dlt=true</code> in the logging section of your configuration file.</p></div>
<div class="paragraph"><p>The DLT application ID is always set to <code>CAPI</code>; the context ID can be set by the application (see e.g. example 01):</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>CommonAPI<span style="color: #990000">::</span>Runtime<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">setProperty</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"LogContext"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"E01C"</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>The default value for the <em>LogContext</em> is <code>CAPI</code>.</p></div>
</div>
<div class="sect3">
<h4 id="_cmake">CMake</h4>
<div class="paragraph"><p>Since version 3 the build system of CommonAPI has been converted from Autotools to CMake (<a href="http://www.cmake.org/">http://www.cmake.org/</a>). A good starting point for writing CMake files for your application are the CMake files which are delivered with the CommonAPI examples in the CommonAPI Tools project.</p></div>
<div class="paragraph"><p>Here are some additional hints how specific problems related to Franca IDL and CMake can be solved.</p></div>
<div class="sect4">
<h5 id="_get_a_cmake_variable_with_all_generated_files">Get a CMake variable with all generated files</h5>
<div class="paragraph"><p>Let&#8217;s assume that the code generator has generated all source fules into thedirectory src-gen. The CMake command:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>FILE(GLOB GEN_SRCS src-gen/*cpp)</code></pre>
</div></div>
<div class="paragraph"><p>creates the CMake variable <code>GEN_SRC</code> which can be used e.g. like</p></div>
<div class="listingblock">
<div class="content">
<pre><code>add_executable(${GEN_SRCS} _&lt;other sources&gt;_)</code></pre>
</div></div>
<div class="paragraph"><p>for building the execuatble.</p></div>
</div>
<div class="sect4">
<h5 id="_generate_code_within_your_cmake_file">Generate code within your CMake file</h5>
<div class="paragraph"><p>As described before one step in building your application is the generation of source files from your Franca interface specification. If you do not want to start the code generator manually you have several possibilities to automate that step. The following extract of a CMake file shows how it could be done within a CMake file.</p></div>
<div class="paragraph"><p>We assume that your fidl files are located in the subdirecory <em>fidl</em> of your project directory and the generated output in <em>src-gen</em>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>set(FIDL_DIR ${PRJ_SRC_DIR}/fidl)
set(GEN_SRC_DIR ${PRJ_SRC_DIR}/src-gen)

set(GEN_COMMAND _&lt;path-to-generator&gt;_/commonapi_generator -dest ${GEN_SRC_DIR} ${FIDL_DIR}/MyFidl.fidl)

add_custom_command(OUTPUT ${SRC_GEN_DIR}/_&lt;generated-source-files&gt;_.cpp
    COMMAND ${GEN_COMMAND}
    DEPENDS ${FIDL_DIR}/MyFidl.fidl
    WORKING_DIRECTORY ${PRJ_SRC_DIR}
    COMMENT "Call CommonAPI code generator."
)</code></pre>
</div></div>
<div class="paragraph"><p>Set the <code>OUTPUT</code> in the custom command to all generated src files.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="../images/icons/note.png" alt="Note" />
</td>
<td class="content">For CommonAPI itself it might be possible that there are no cpp files in the output. This is the case if you don&#8217;t generate the skeletons for the stub and you don&#8217;t have any complex datatypes in yor fidl file.</td>
</tr></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_windows">Windows</h3>
<div class="paragraph"><p>CommonAPI can also run on Windows platforms. In order to get a running system please refer to the binding specific user guides. To compile CommonAPI for Windows, do the following steps:</p></div>
<div class="ulist"><ul>
<li>
<p>
Open the file <code>CommonAPI.sln</code> with Visual Studio 2013 (at least Update 4).
</p>
</li>
<li>
<p>
Build the project <code>CommonAPI</code>.
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basic_features">Basic Features</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_new_commonapi_3_features">New CommonAPI 3 Features</h3>
<div class="paragraph"><p>The new CommonAPI version 3 contains a number of bug fixes, some internal modifications and new features. For the user of CommonAPI there are not as many changes as it may seem at first glance. The following sections provide an overview of the most important changes.</p></div>
<div class="sect3">
<h4 id="_franca_and_deployment">Franca And Deployment</h4>
<div class="paragraph"><p>CommonAPI 3 supports Franca IDL 0.9.1 and additionally some new deployment parameters (see chapter <em>CommonAPI Deployment</em>).</p></div>
</div>
<div class="sect3">
<h4 id="_build_system_cmake">Build System CMake</h4>
<div class="paragraph"><p>The build system of CommonAPI has been converted from Autotools to CMake. Please refer to the build instructions of this user guide. For an improved window support also Windows project files are delivered.</p></div>
</div>
<div class="sect3">
<h4 id="_changed_configuration_files">Changed Configuration Files</h4>
<div class="paragraph"><p>The configuration files have now the ini file format and some additional settings. Please refer to the chapter <em>Write CommonAPI Configuration Files</em>.</p></div>
</div>
<div class="sect3">
<h4 id="_commonapi_logging_2">CommonAPI Logging</h4>
<div class="paragraph"><p>CommonAPI 3 provides logging messages, e.g. in DLT format. Refer to chapter <em>CommonAPI Logging</em>.</p></div>
</div>
<div class="sect3">
<h4 id="_new_code_generator_command_line_parameters">New Code Generator Command-line Parameters</h4>
<div class="paragraph"><p>The parameters of the code generator are now significantly extended. The usage of the code generator is now (Linux 32 bit):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>commonapi-generator-linux-x86 &lt;options&gt; &lt;fidl files&gt;</code></pre>
</div></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="44%" />
<col width="55%" />
<thead>
<tr>
<th align="left" valign="top">Options</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>-h, --help</code></p></td>
<td align="left" valign="top"><p class="table">display help of available console commands</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-p,--plugins</code></p></td>
<td align="left" valign="top"><p class="table">print plug-in versions</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-v,--version</code></p></td>
<td align="left" valign="top"><p class="table">print code generator version</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-d,--dest</code> <em>&lt;arg&gt;</em></p></td>
<td align="left" valign="top"><p class="table">The default output directory</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-dc,--dest-common</code> <em>&lt;arg&gt;</em></p></td>
<td align="left" valign="top"><p class="table">The directory for the common code</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-dp,--dest-proxy</code> <em>&lt;arg&gt;</em></p></td>
<td align="left" valign="top"><p class="table">The directory for proxy code</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-ds,--dest-stub</code> <em>&lt;arg&gt;</em></p></td>
<td align="left" valign="top"><p class="table">The directory for stub code</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-dsk,--dest-skel</code> <em>&lt;arg&gt;</em></p></td>
<td align="left" valign="top"><p class="table">The directory for the skeleton code</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-dsub,--dest-subdirs</code> <em>&lt;arg&gt;</em></p></td>
<td align="left" valign="top"><p class="table">Use a subdirectory per interfaceUse a subdirectory per interface</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-l,--license</code> <em>&lt;arg&gt;</em></p></td>
<td align="left" valign="top"><p class="table">The file path to the license text that will be added to each generated file</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-ll,--loglevel</code> <em>&lt;arg&gt;</em></p></td>
<td align="left" valign="top"><p class="table">The log level (quiet or verbose)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-nc,--no-common</code></p></td>
<td align="left" valign="top"><p class="table">Switch off generation of common code</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-ng,--no-gen</code></p></td>
<td align="left" valign="top"><p class="table">Switch off code generation completely</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-np,--no-proxy</code></p></td>
<td align="left" valign="top"><p class="table">Switch off generation of proxy code</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-ns,--no-stub</code></p></td>
<td align="left" valign="top"><p class="table">Switch off generation of stub code</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-nsc,--no-sync-calls</code></p></td>
<td align="left" valign="top"><p class="table">Switch off code generation of synchronous methods</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-nv,--no-val</code></p></td>
<td align="left" valign="top"><p class="table">Switch off validation of the fidl file</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-pf,--printfiles</code></p></td>
<td align="left" valign="top"><p class="table">Print out generated files</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-pre,--prefix-enum-literal</code> <em>&lt;arg&gt;</em></p></td>
<td align="left" valign="top"><p class="table">The prefix added to all generated enumeration literals</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-sk,--skel</code> <em>&lt;arg&gt;</em></p></td>
<td align="left" valign="top"><p class="table">Generate skeleton code. The optional argument specifies the postfix. Without argument, the postfix is <em>default</em></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-sp,--searchpath</code> <em>&lt;arg&gt;</em></p></td>
<td align="left" valign="top"><p class="table">The search path to contain fidl/fdepl files</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-wod,--without-dependencies</code></p></td>
<td align="left" valign="top"><p class="table">Switch off code generation of dependencies</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Please note:</p></div>
<div class="ulist"><ul>
<li>
<p>
It is now possible to define different destination directories for proxy, stub and common code and to switch off the generation of proxy, stub or common code.
</p>
</li>
<li>
<p>
The CommonAPI 2.x code generator always generated default implementations for the stubs (skeleton). This is not the default behavior anymore. Call the code generator with the option <code>-sk</code> without an argument to get the same result as before.
</p>
</li>
<li>
<p>
It is possible to influence the literals of enumerations by setting the option <code>-pre</code>. With this option you can add a custom prefix to all generated enumeration literals.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_version_in_namespace">Version In Namespace</h4>
<div class="paragraph"><p>Since CommonAPI version 3, the version of the Franca interface becomes part of the C++ namespace. The version is added at the beginning of the namespace path, e.g. for an interface with version 1.0 the modified namespace begins with <code>v1</code>. Please refer to chapter <em>Namespaces</em> for further information.</p></div>
</div>
<div class="sect3">
<h4 id="_new_runtime_loading_concept">New Runtime Loading Concept</h4>
<div class="paragraph"><p>With CommonAPI 2.x you had to follow three steps to create proxies (or stubs):</p></div>
<div class="ulist"><ul>
<li>
<p>
Get a runtime object for your required middleware.
</p>
</li>
<li>
<p>
Create a factory from this runtime object (optionally with a mainloop context).
</p>
</li>
<li>
<p>
Build your proxy using this factory; one argument is the CommonAPI address.
</p>
</li>
</ul></div>
<div class="paragraph"><p>This procedure has been simplified and improved for the dynamic loading of CommonAPI bindings. For the relevant details see chapter <em>Creating Proxies And Stubs</em>.</p></div>
</div>
<div class="sect3">
<h4 id="_asynchronous_stubs">Asynchronous Stubs</h4>
<div class="paragraph"><p>For client implementations CommonAPI offers the possibility to call functions (Franca methods or setter/getter functions for attributes) synchronously or asynchronously. In the asynchronous case the reply for the call will come as callback-function call. On stub side CommonAPI required to calculate the return values immediatly (see picture).</p></div>
<div class="imageblock">
<div class="content">
<img src="../images/AsynchronousStubs.png" alt="Asynchronous Stubs image" />
</div>
<div class="title">Figure 8. Asynchronous Stubs</div>
</div>
<div class="paragraph"><p>But some applications work as kind of intermediate layer and simply pass on function calls to a next application. In this case it was only under relatively high cost possible to pass the function calls to another application and to delegate the calculation of the return values. This is now possible because the return values are now wrapped into a function object which can be passed to another execution path.</p></div>
</div>
<div class="sect3">
<h4 id="_callinfo_for_method_calls">CallInfo For Method Calls</h4>
<div class="paragraph"><p>Method calls now have an additional, optional parameter which is called <code>CallInfo</code>. See e.g. the generated call <code>sayHello</code> on proxy side:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">virtual</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">sayHello</span></span><span style="color: #990000">(</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> std<span style="color: #990000">::</span><span style="color: #008080">string</span> <span style="color: #990000">&amp;</span>_name<span style="color: #990000">,</span> CommonAPI<span style="color: #990000">::</span><span style="color: #008080">CallStatus</span> <span style="color: #990000">&amp;</span>_status<span style="color: #990000">,</span>
    std<span style="color: #990000">::</span><span style="color: #008080">string</span> <span style="color: #990000">&amp;</span>_message<span style="color: #990000">,</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> CommonAPI<span style="color: #990000">::</span><span style="color: #008080">CallInfo</span> <span style="color: #990000">*</span>_info <span style="color: #990000">=</span> nullptr
<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p><code>CallInfo</code> is defined as:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">COMMONAPI_EXPORT</span> CallInfo <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">CallInfo</span></span><span style="color: #990000">()</span>
        <span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #000000">timeout_</span></span><span style="color: #990000">(</span>DEFAULT_SEND_TIMEOUT_MS<span style="color: #990000">),</span> <span style="font-weight: bold"><span style="color: #000000">sender_</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #000000">CallInfo</span></span><span style="color: #990000">(</span><span style="color: #008080">Timeout_t</span> _timeout<span style="color: #990000">)</span>
        <span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #000000">timeout_</span></span><span style="color: #990000">(</span>_timeout<span style="color: #990000">),</span> <span style="font-weight: bold"><span style="color: #000000">sender_</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #FF0000">}</span>

    <span style="color: #008080">Timeout_t</span> timeout_<span style="color: #990000">;</span>
    <span style="color: #008080">Sender_t</span> sender_<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span></tt></pre></div></div>
<div class="paragraph"><p>The <code>timeout_</code> defines how long the client will wait for the response from the service before it returns with CallStatus <code>REMOTE_ERROR</code>.</p></div>
<div class="paragraph"><p>The attribute <code>sender_</code> can be used for passing an application specific sender handle to the method call which can be used in bindings to log the correlation between the sender handle and middleware specific information like serial numbers.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_proxies_and_stubs">Creating Proxies And Stubs</h3>
<div class="paragraph"><p>The CommonAPI runtime creates proxies/registers stubs at the binding which is either configured for the given proxy/stub instance or is the default binding if no configured binding could be found. The configuration of a binding for a specific instance is done by providing an address mapping for the instance. An address mapping can either be specified using a deployment file to generate the interface specific binding code or by an entry in the binding configuration file. Such entries look like:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[_&lt;commonapi address&gt;_]
_&lt;ipc specific address parameter&gt;_ = ...
_&lt;ipc specific address parameter&gt;_ = ...
...</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="../images/icons/note.png" alt="Note" />
</td>
<td class="content">CommonAPI does not check for multiple definitions for the same CommonAPI address. In this case, the binding that was registered first, will be used to create the proxy/register the stub.</td>
</tr></table>
</div>
<div class="paragraph"><p>The default default binding is "dbus". This can be changed by setting the "binding" variable in the "default"-section of the CommonAPI configuration file or by setting the environment variable "COMMONAPI_DEFAULT_BINDING". The environment variable overwrites the setting provided by the configuration file.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="../images/icons/note.png" alt="Note" />
</td>
<td class="content">A binding that is used as default binding should be able to automatically (without further configuration) translate CommonAPI addresses to the addresses used by the communication mechanism it binds to. Otherwise all used instances must be defined in the deployment.</td>
</tr></table>
</div>
<div class="paragraph"><p>Bindings are implicitly registered by the binding specific generated code for an interface. This code can either be statically linked or dynamically loaded at runtime. In the first case, the bindings an application uses are statically bound to the application while in the second case the application and their used bindings are independent from each other. The name of a library that needs to be loaded before being able to create a proxy or register a stub for a specific interface instance is determined
as follows:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
It is checked whether the requested action can be done be an already registered factory.
</p>
</li>
<li>
<p>
If 1. fails, the name of the library that contains the needed code is determined:
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
If the requested proxy/stub instance is configured, the configured name will be used. Such configurations are done in the "proxy" and "stub" sections of the CommonAPI configuration file and look like: <em>&lt;commonapi address&gt;</em> = <em>&lt;library name&gt;</em>
</p>
</li>
<li>
<p>
If no configuration exists it is checked whether the property "LibraryBase" is set. If yes, the name is set to <em>lib&lt;LibraryBase&gt;</em>.
</p>
</li>
<li>
<p>
If neither a configuration exists nor the property "LibraryBase" is set, the name will be built from the CommonAPI address as <em>lib&lt;domain&gt;<em>_</em>&lt;interface&gt;</em><em>_&lt;instance&gt;</em>.
</p>
</li>
</ol></div>
</li>
<li>
<p>
The runtime tries to load the library with the determined name. If it succeeds, it tries to create the proxy/register the stub again.
</p>
</li>
</ol></div>
</div>
<div class="sect2">
<h3 id="_namespaces">Namespaces</h3>
<div class="paragraph"><p>See the example <code>E01HelloWorld</code>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">package</span></span> commonapi<span style="color: #990000">.</span>examples

<span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">E01HelloWorld</span> <span style="color: #FF0000">{</span>
    version <span style="color: #FF0000">{</span> major <span style="color: #993399">0</span> minor <span style="color: #993399">1</span> <span style="color: #FF0000">}</span>

    <span style="font-style: italic"><span style="color: #9A1900">// Interface definition here</span></span>

<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The generated code looks as follows:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">namespace</span></span> v0 <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #0000FF">namespace</span></span> commonapi <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #0000FF">namespace</span></span> examples <span style="color: #FF0000">{</span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">E01HelloWorld</span> <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #0000FF">public</span></span><span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #0000FF">virtual</span></span> <span style="color: #990000">~</span><span style="font-weight: bold"><span style="color: #000000">E01HelloWorld</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span> <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">inline</span></span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span><span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">getInterface</span></span><span style="color: #990000">();</span>
    <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">inline</span></span> CommonAPI<span style="color: #990000">::</span><span style="color: #008080">Version</span> <span style="font-weight: bold"><span style="color: #000000">getInterfaceVersion</span></span><span style="color: #990000">();</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span><span style="color: #990000">*</span> E01HelloWorld<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">getInterface</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"commonapi.examples.E01HelloWorld"</span><span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>

CommonAPI<span style="color: #990000">::</span><span style="color: #008080">Version</span> E01HelloWorld<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">getInterfaceVersion</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> CommonAPI<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">Version</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="color: #FF0000">}</span> <span style="font-style: italic"><span style="color: #9A1900">// namespace examples</span></span>
<span style="color: #FF0000">}</span> <span style="font-style: italic"><span style="color: #9A1900">// namespace commonapi</span></span>
<span style="color: #FF0000">}</span> <span style="font-style: italic"><span style="color: #9A1900">// namespace v0</span></span>
</tt></pre></div></div>
<div class="paragraph"><p>The generated code will be generated into the directory <code>src-gen/v0/commonapi/examples</code>.</p></div>
<div class="paragraph"><p>The main reason for adding the version at the beginning of the namespace is that we consider the name of the interfaces together with the package path (fully qualified name) as a unit, as it is specified in the Franca file. This name should not be destroyed by an intervening add on.</p></div>
<div class="paragraph"><p>It is however possible to create project specific namespaces if needed, as the following example shows:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;iostream&gt;</span>

<span style="font-weight: bold"><span style="color: #0000FF">namespace</span></span> v1_0 <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #0000FF">namespace</span></span> commonapi <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #0000FF">namespace</span></span> examples <span style="color: #FF0000">{</span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">MySample</span> <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #0000FF">public</span></span><span style="color: #990000">:</span>
    <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">print</span></span><span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #FF0000">{</span> std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"commonapi.examples.v1_0.MySample"</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span> <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="color: #FF0000">}</span> <span style="font-style: italic"><span style="color: #9A1900">// namespace examples</span></span>
<span style="color: #FF0000">}</span> <span style="font-style: italic"><span style="color: #9A1900">// namespace commonapi</span></span>
<span style="color: #FF0000">}</span> <span style="font-style: italic"><span style="color: #9A1900">// namespace v1_0</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">namespace</span></span> v1_1 <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #0000FF">namespace</span></span> commonapi <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #0000FF">namespace</span></span> examples <span style="color: #FF0000">{</span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">MySample</span> <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #0000FF">public</span></span><span style="color: #990000">:</span>
        <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">print</span></span><span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #FF0000">{</span> std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"commonapi.examples.v1_1.MySample"</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span> <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="color: #FF0000">}</span> <span style="font-style: italic"><span style="color: #9A1900">// namespace examples</span></span>
<span style="color: #FF0000">}</span> <span style="font-style: italic"><span style="color: #9A1900">// namespace commonapi</span></span>
<span style="color: #FF0000">}</span> <span style="font-style: italic"><span style="color: #9A1900">// namespace v1_1</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">namespace</span></span> commonapi <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #0000FF">namespace</span></span> examples <span style="color: #FF0000">{</span>

<span style="font-weight: bold"><span style="color: #0000FF">namespace</span></span> V1_0 <span style="color: #990000">=</span> v1_0<span style="color: #990000">::</span>commonapi<span style="color: #990000">::</span>examples<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">namespace</span></span> V1_1 <span style="color: #990000">=</span> v1_1<span style="color: #990000">::</span>commonapi<span style="color: #990000">::</span>examples<span style="color: #990000">;</span>

<span style="color: #FF0000">}</span> <span style="font-style: italic"><span style="color: #9A1900">// namespace examples</span></span>
<span style="color: #FF0000">}</span> <span style="font-style: italic"><span style="color: #9A1900">// namespace commonapi</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">using</span></span> <span style="font-weight: bold"><span style="color: #0000FF">namespace</span></span> commonapi<span style="color: #990000">::</span>examples<span style="color: #990000">;</span>

<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span>argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    V1_0<span style="color: #990000">::</span><span style="color: #008080">MySample</span> aSample<span style="color: #990000">;</span>
    V1_1<span style="color: #990000">::</span><span style="color: #008080">MySample</span> bSample<span style="color: #990000">;</span>

    aSample<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">print</span></span><span style="color: #990000">();</span>
    bSample<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">print</span></span><span style="color: #990000">();</span>

    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_multithreading_and_mainloops">Multithreading and Mainloops</h3>
<div class="paragraph"><p>Please refer to example 07 for an example of the CommonAPI mainloop integration with the <code>glib</code> mainloop.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_examples">Examples</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_preliminary_remarks">Preliminary remarks</h3>
<div class="paragraph"><p>The examples describe how some standard problems of interface design and implementation can be solved with Franca IDL and CommonAPI. Before you start make sure that your environment is properly installed as described in the integration guide. Please do not consider only the integration guide in this document but also in the binding specific tutorial.</p></div>
<div class="paragraph"><p>The examples provide a more or less generic CMake file for building the executables. Two executables are needed: a service and a client program. The standard procedure to build one of these example programs is:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ cd build
$ cmake -DUSE_INSTALLED_COMMONAPI=ON/OFF ..
$ make</code></pre>
</div></div>
<div class="paragraph"><p>Set <code>USE_INSTALLED_COMMONAPI</code> to <code>ON</code> if you use an installed version of CommonAPI; set it to <code>OFF</code> if you use the working copy.</p></div>
<div class="paragraph"><p>In case you are using the D-Bus binding and you have not installed the patched D-Bus library (<em>libdbus</em>) it might be necessary to set a D-Bus specific option:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>cmake -DUSE_INSTALLED_COMMONAPI=OFF -DUSE_INSTALLED_DBUS=OFF ..</code></pre>
</div></div>
<div class="paragraph"><p>Please read also the chapters in the user guide about the configuration files. One possibility to specify the path to the CommonAPI configuration file is to set the environment variable:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>export COMMONAPI_CONFIG=&lt;path to CommonAPI-Examples&gt;/E01HelloWorld/commonapi4dbus.ini</code></pre>
</div></div>
<div class="paragraph"><p>If do not specify any configuration file it is assumed that you want to use the D-Bus binding. Other environment variables you might need are:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>LD_LIBRARY_PATH</code> should contain the path to the <em>libdbus</em> if you use the D-Bus binding with an uninstalled <em>libdbus</em> and should contain the path to your gluecode libraries, e.g. <code>LD_LIBRARY_PATH=&lt;path to libdbus&gt;/dbus-1.8.20/dbus/.libs:&lt;path to CommonAPI-Tools&gt;/CommonAPI-Examples/E01HelloWorld/build</code>
</p>
</li>
<li>
<p>
<code>VSOMEIP_CONFIGURATION</code> should contain the path to your vsomeip configuration file if you are using the SOME/IP binding, e.g. <code>VSOMEIP_CONFIGURATION=&lt;path to CommonAPI-Tools&gt;/CommonAPI-Examples/E01HelloWorld/vsomeip-local.json</code>
</p>
</li>
<li>
<p>
<code>COMMONAPI_OVERRIDE_GLOBAL_CALL_TIMEOUT</code> overrides the timeout for all calls, default and custom, by assigning a value in ms to the environment variable, e.g. <code>COMMONAPI_OVERRIDE_GLOBAL_CALL_TIMEOUT=3000</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Here are some hints if you want to configure your eclipse project for the CMake build:</p></div>
<div class="ulist"><ul>
<li>
<p>
Install the CMakeEd plug-in which provides an editor for CMake files (<a href="http://cmakeed.sourceforge.net/eclipse/">http://cmakeed.sourceforge.net/eclipse/</a>).
</p>
</li>
<li>
<p>
Create a build directory (e.g. /build) directly in the project directory.
</p>
</li>
<li>
<p>
Select the projects properties, then C/C++ build and set the Build Command to your make call:
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code>make -C ${ProjDirPath}/build VERBOSE=1</code></pre>
</div></div>
<div class="paragraph"><p>The build directory must be empty. Create a make target (e.g. via <em>Window&#8594;Show View&#8594;Make Target</em>). Set the build command to:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>cmake -E chdir build/ cmake &lt;options&gt; ..</code></pre>
</div></div>
<div class="paragraph"><p>The above described environment variables you could specify in the <em>Run Configuration</em> of your executable files (cleint and service).</p></div>
</div>
<div class="sect2">
<h3 id="_example_01_hello_world">Example 01: Hello World</h3>
<div class="paragraph"><p>This example contains step-by-step instructions how to create the code for the <code>Hello World</code> introductory example of CommonAPI C++. Even this is a CommonAPI tutorial with no references to any special bindings, we give here some hints concerning existing bindings. For a deeper insight please refer to the binding specific tutorials. We assume that you use the Eclipse tool chain and that everything is properly installed as described in the Integration Guide of this tutorial.</p></div>
<div class="paragraph"><p>The first step in developing a CommonAPI application likely will be the definition of the RMI interface the client will use to communicate with the server. In the context of CommonAPI, the definition of this interface always happens via the Franca IDL, regardless of which communication mechanism you intend to use in the end.</p></div>
<div class="paragraph"><p>For this tutorial, create an arbitrarily named file ending in <em>.fidl</em> in your Eclipse project (in this case <em>E01HelloWorld.fidl</em>). It is not relevant where in your project you have placed this file, as the code generated from this file will always be put in the automatically created src-gen folder at the top level of the project hierarchy.</p></div>
<div class="paragraph"><p>Open your newly created <em>E01HelloWorld.fidl</em>-file, and type the following lines:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">package</span></span> commonapi<span style="color: #990000">.</span>examples

<span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">E01HelloWorld</span> <span style="color: #FF0000">{</span>
    version <span style="color: #FF0000">{</span> major <span style="color: #993399">0</span> minor <span style="color: #993399">1</span> <span style="color: #FF0000">}</span>

    <span style="color: #008080">method</span> sayHello <span style="color: #FF0000">{</span>
        in <span style="color: #FF0000">{</span>
            String name
        <span style="color: #FF0000">}</span>
        out <span style="color: #FF0000">{</span>
            String message
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Now, save the <em>.fidl</em> file and right click it. As you have installed the CommonAPI code generator and further generators for the bindings, you will see a menu item saying <em>Common API</em>, with sub menu items for generating the Common API level code only (<em>Generate C++ Code</em>) and for generating the required glue code (e.g. for D-Bus you find <em>Generate D-Bus C++ Code</em>).</p></div>
<div class="paragraph"><p>Now start the code generators. You will find the generated code in the sub-directory <code>src-gen</code>.</p></div>
<div class="paragraph"><p>All files that have a the name of your binding (e.g. <em>DBus</em>) in their name are glue code required by the binding and are not relevant while developing your application, they only need to be compiled with your application.</p></div>
<div class="paragraph"><p>All other files that have a <em>Proxy</em> in their name are relevant for you if you develop a client, all other files that have a <em>Stub</em> in their name are relevant for you if you develop a service. A proxy is a class that provides method calls that will result in remote method invocations on the service, plus registration methods for events that can be broadcasted by the service.</p></div>
<div class="paragraph"><p>A stub is the part of the service that will be called when a remote method invocation from a client arrives. It also contains methods to fire events (broadcasts) to several or all clients. The stub comes in two flavors: one default stub that contains empty implementations of all methods, thereby allowing you to implement only the ones you are interested in, and a Stub skeleton where you have to implement everything yourself before you can use it. A service will have to implement a subclass of either of the two in order to make itself available to the outside world (or just use the default stub if your service should not be able to do anything except firing events).</p></div>
<div class="paragraph"><p>In this tutorial, we will create both a client and a service in order to be able to see some communication going on.</p></div>
<div class="paragraph"><p>Start by implementing the client by creating a new <code>.cpp</code> source file in your project (e.g. <em>e01HelloWorldClient.cpp</em>). Make sure you have a main method in order to start the client application.</p></div>
<div class="paragraph"><p>Here, you will need two includes in order to access the Common API client functionality:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;iostream&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;unistd.h&gt;</span>

<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;CommonAPI/CommonAPI.hpp&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;v0/commonapi/examples/E01HelloWorldProxy.hpp&gt;</span></tt></pre></div></div>
<div class="paragraph"><p>Please note that you always have to include <code>CommonAPI.hpp</code> for accessing the runtime part of CommonAPI and the generated proxy. If your defined interface has a version number then you will find the version in the namespace of your interface class and in the directory structure.</p></div>
<div class="paragraph"><p>One of the first things each and every CommonAPI application will do is to get a pointer to the runtime object:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>std<span style="color: #990000">::</span>shared_ptr <span style="color: #990000">&lt;</span> CommonAPI<span style="color: #990000">::</span>Runtime <span style="color: #990000">&gt;</span> runtime <span style="color: #990000">=</span> CommonAPI<span style="color: #990000">::</span>Runtime<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">();</span></tt></pre></div></div>
<div class="paragraph"><p>Please ignore for this introduction the <code>CommonAPI::Runtime::setProperty</code> calls (refer to the Integration Guide of this tutorial).</p></div>
<div class="paragraph"><p>In order to be able to communicate with a specific service, we need a proxy:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>std<span style="color: #990000">::</span><span style="color: #008080">string</span> domain <span style="color: #990000">=</span> <span style="color: #FF0000">"local"</span><span style="color: #990000">;</span>
std<span style="color: #990000">::</span><span style="color: #008080">string</span> instance <span style="color: #990000">=</span> <span style="color: #FF0000">"commonapi.examples.HelloWorld"</span><span style="color: #990000">;</span>
std<span style="color: #990000">::</span><span style="color: #008080">string</span> connection <span style="color: #990000">=</span> <span style="color: #FF0000">"client-sample"</span><span style="color: #990000">;</span>

std<span style="color: #990000">::</span><span style="color: #008080">shared_ptr&lt;E01HelloWorldProxyDefault&gt;</span> myProxy <span style="color: #990000">=</span> runtime<span style="color: #990000">-&gt;</span>buildProxy<span style="color: #990000">&lt;</span>E01HelloWorldProxy<span style="color: #990000">&gt;(</span>domain<span style="color: #990000">,</span> instance<span style="color: #990000">,</span> connection<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>The domain and the instance name determine explicitly together with the generated proxy class as template parameter which stub will be addressed by this proxy. The <em>connection</em> is an optional argument. This argument allows to group several proxies in a so-called connection. Internally a connection corresponds to one receiver thread if there is no mainloop integration.</p></div>
<div class="paragraph"><p>With the instantiation of the proxy, the client is set up and ready to use. In this example we wait for the service to be available, then we start issuing calls:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(!</span>myProxy<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">isAvailable</span></span><span style="color: #990000">())</span>
    std<span style="color: #990000">::</span>this_thread<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">sleep_for</span></span><span style="color: #990000">(</span>std<span style="color: #990000">::</span>chrono<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">microseconds</span></span><span style="color: #990000">(</span><span style="color: #993399">10</span><span style="color: #990000">));</span>


<span style="font-weight: bold"><span style="color: #0000FF">const</span></span> std<span style="color: #990000">::</span><span style="color: #008080">string</span> name <span style="color: #990000">=</span> <span style="color: #FF0000">"World"</span><span style="color: #990000">;</span>
CommonAPI<span style="color: #990000">::</span><span style="color: #008080">CallStatus</span> callStatus<span style="color: #990000">;</span>
std<span style="color: #990000">::</span><span style="color: #008080">string</span> returnMessage<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    myProxy<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">sayHello</span></span><span style="color: #990000">(</span>name<span style="color: #990000">,</span> callStatus<span style="color: #990000">,</span> returnMessage<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>callStatus <span style="color: #990000">!=</span> CommonAPI<span style="color: #990000">::</span>CallStatus<span style="color: #990000">::</span>SUCCESS<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cerr <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Remote call failed!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Got message: '"</span> <span style="color: #990000">&lt;&lt;</span> returnMessage <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"'</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">;</span>
    std<span style="color: #990000">::</span>this_thread<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">sleep_for</span></span><span style="color: #990000">(</span>std<span style="color: #990000">::</span>chrono<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">seconds</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">));</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The implementation of the service works about the same way as implementing the client. The includes that are required are the following:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;iostream&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;thread&gt;</span>

<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;CommonAPI/CommonAPI.hpp&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"E01HelloWorldStubImpl.hpp"</span></tt></pre></div></div>
<div class="paragraph"><p>In the main function of the service one of the first things to do is to get the runtime object. After that we have to instantiate our stub implementation (here <code>E01HelloWorldStubImpl</code>) and then to register it:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>std<span style="color: #990000">::</span><span style="color: #008080">shared_ptr&lt;CommonAPI::Runtime&gt;</span> runtime <span style="color: #990000">=</span> CommonAPI<span style="color: #990000">::</span>Runtime<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">();</span>

std<span style="color: #990000">::</span><span style="color: #008080">string</span> domain <span style="color: #990000">=</span> <span style="color: #FF0000">"local"</span><span style="color: #990000">;</span>
std<span style="color: #990000">::</span><span style="color: #008080">string</span> instance <span style="color: #990000">=</span> <span style="color: #FF0000">"commonapi.examples.HelloWorld"</span><span style="color: #990000">;</span>
std<span style="color: #990000">::</span><span style="color: #008080">string</span> connection <span style="color: #990000">=</span> <span style="color: #FF0000">"service-sample"</span><span style="color: #990000">;</span>

std<span style="color: #990000">::</span><span style="color: #008080">shared_ptr&lt;E01HelloWorldStubImpl&gt;</span> myService <span style="color: #990000">=</span> std<span style="color: #990000">::</span>make_shared<span style="color: #990000">&lt;</span>E01HelloWorldStubImpl<span style="color: #990000">&gt;();</span>
runtime<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">registerService</span></span><span style="color: #990000">(</span>domain<span style="color: #990000">,</span> instance<span style="color: #990000">,</span> myService<span style="color: #990000">,</span> connection<span style="color: #990000">);</span>

<span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Waiting for calls... (Abort with CTRL+C)"</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    std<span style="color: #990000">::</span>this_thread<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">sleep_for</span></span><span style="color: #990000">(</span>std<span style="color: #990000">::</span>chrono<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">seconds</span></span><span style="color: #990000">(</span><span style="color: #993399">60</span><span style="color: #990000">));</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The implementation of the generated stub method <code>sayHello</code> looks like:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">void</span> E01HelloWorldStubImpl<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">sayHello</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> std<span style="color: #990000">::</span><span style="color: #008080">shared_ptr&lt;CommonAPI::ClientId&gt;</span> _client<span style="color: #990000">,</span>
        std<span style="color: #990000">::</span><span style="color: #008080">string</span> _name<span style="color: #990000">,</span>
        <span style="color: #008080">sayHelloReply_t</span> _reply<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>

    std<span style="color: #990000">::</span><span style="color: #008080">stringstream</span> messageStream<span style="color: #990000">;</span>

    messageStream <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Hello "</span> <span style="color: #990000">&lt;&lt;</span> _name <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"!"</span><span style="color: #990000">;</span>
    std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"sayHello('"</span> <span style="color: #990000">&lt;&lt;</span> _name <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"'): '"</span> <span style="color: #990000">&lt;&lt;</span> messageStream<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">str</span></span><span style="color: #990000">()</span> <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"'</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #000000">_reply</span></span><span style="color: #990000">(</span>messageStream<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">str</span></span><span style="color: #990000">());</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span></tt></pre></div></div>
<div class="paragraph"><p>Build the two applications using your favourite build system (e.g. see the CMake files in the example folder). If all worked well, you should see communication ongoing (e.g. via dbus-monitor), and you should get output from your client.</p></div>
</div>
<div class="sect2">
<h3 id="_example_02_attributes">Example 02: Attributes</h3>
<div class="paragraph"><p>Consider the Franca IDL specification of example 2:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">package</span></span> commonapi<span style="color: #990000">.</span>examples

<span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">E02Attributes</span> <span style="color: #FF0000">{</span>
    version <span style="color: #FF0000">{</span> major <span style="color: #993399">1</span> minor <span style="color: #993399">0</span> <span style="color: #FF0000">}</span>

    attribute Int32 x
    <span style="color: #008080">attribute</span> CommonTypes<span style="color: #990000">.</span>a1Struct a1
<span style="color: #FF0000">}</span>

<span style="color: #008080">typeCollection</span> CommonTypes <span style="color: #FF0000">{</span>
    version <span style="color: #FF0000">{</span> major <span style="color: #993399">1</span> minor <span style="color: #993399">0</span> <span style="color: #FF0000">}</span>

    <span style="color: #008080">struct</span> a1Struct <span style="color: #FF0000">{</span>
        String s
        a2Struct a2
    <span style="color: #FF0000">}</span>

    <span style="color: #008080">struct</span> a2Struct <span style="color: #FF0000">{</span>
        Int32 a
        Boolean b
        Double d
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Modelling attributes in interfaces means in general that the service that implements this interface has an internal state which shall be visible for external clients like a HMI (Human Machine Interface). A developer of a client would normally expect that he can set and get the attribute and that he can notify or subscribe to changes of the value of the attribute. We will see below in the implementation how exactly this is realized by CommonAPI. Franca offers two key words that indicate exactly how the attribute can be accessed: <code>readonly</code> and <code>noSubscriptions</code>. The default setting is that everything is allowed; with these two additional key words these possibilities can be limited (e.g. if someone tries to call a set method and the attribute is <code>readonly</code> he will get an error at compile time).</p></div>
<div class="paragraph"><p>The nested structure <code>a1Struct</code> is defined in a type collection <code>CommonTypes</code>. Structures can be defined just like other type definitions within an interface definition or outside in a type collection. Since Franca 0.8.9 type collections can also be anonymous (without name). A type collection is transferred by the CommonAPI code generator in an additional namespace.</p></div>
<div class="paragraph"><p>The Franca interface specification of attributes does not contain any information about whether the access from client side is synchronous or asynchronous or whether the attribute is cached by the proxy. CommonAPI provides always methods for synchronous and asynchronous setter and getter methods; caching can be realized via an API extension.</p></div>
<div class="paragraph"><p>Now let&#8217;s have a look to the CommonAPI code on the service side. The default implementation of the stub which is generated by the CommonAPI code generator defines the attribute as private attribute of the stub class. This attribute can be accessed from the stub implementation via getter and setter functions. Additionally the API for the stub implementation provides some callbacks (the following code snippet shows parts of the generated header of the stub class which refer to the attribute x):</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">E02AttributesStubDefault</span> <span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">virtual</span></span> E02AttributesStub <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #0000FF">public</span></span><span style="color: #990000">:</span>
    <span style="font-style: italic"><span style="color: #9A1900">/* some other code here */</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">virtual</span></span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> int32_t<span style="color: #990000">&amp;</span> <span style="font-weight: bold"><span style="color: #000000">getXAttribute</span></span><span style="color: #990000">();</span>
    <span style="font-weight: bold"><span style="color: #0000FF">virtual</span></span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> int32_t<span style="color: #990000">&amp;</span> <span style="font-weight: bold"><span style="color: #000000">getXAttribute</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> std<span style="color: #990000">::</span><span style="color: #008080">shared_ptr&lt;CommonAPI::ClientId&gt;</span> _client<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">virtual</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">setXAttribute</span></span><span style="color: #990000">(</span><span style="color: #008080">int32_t</span> _value<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">virtual</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">setXAttribute</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> std<span style="color: #990000">::</span><span style="color: #008080">shared_ptr&lt;CommonAPI::ClientId&gt;</span> _client<span style="color: #990000">,</span> <span style="color: #008080">int32_t</span> _value<span style="color: #990000">);</span>

<span style="font-weight: bold"><span style="color: #0000FF">protected</span></span><span style="color: #990000">:</span>
    <span style="font-style: italic"><span style="color: #9A1900">/* some other code here */</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">virtual</span></span> <span style="color: #009900">bool</span> <span style="font-weight: bold"><span style="color: #000000">trySetXAttribute</span></span><span style="color: #990000">(</span><span style="color: #008080">int32_t</span> _value<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">virtual</span></span> <span style="color: #009900">bool</span> <span style="font-weight: bold"><span style="color: #000000">validateXAttributeRequestedValue</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">int32_t</span> <span style="color: #990000">&amp;</span>_value<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">virtual</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">onRemoteXAttributeChanged</span></span><span style="color: #990000">();</span>

<span style="font-weight: bold"><span style="color: #0000FF">private</span></span><span style="color: #990000">:</span>
    <span style="font-style: italic"><span style="color: #9A1900">/* some other code here */</span></span>
    <span style="color: #008080">int32_t</span> xAttributeValue_<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span></tt></pre></div></div>
<div class="paragraph"><p>If the implementation of the stub has to change the value of the attribute <code>x</code>, let&#8217;s say in a class <code>E02AttributesStubImpl</code> that is derived from <code>E02AttributesStubDefault</code>, then it can call <code>setXAttribute</code> (analog the usage of <code>getXAttribute</code>). The callback <code>onRemoteXAttributeChanged</code> informs that a change of the attribute <code>x</code> has been completed. The other callbacks can prevent the set of the attribute (<code>validateXAttributeRequestedValue</code>) or change the given value from the client (<code>trySetXAttribute</code>).</p></div>
<div class="paragraph"><p>In the example the service increments a counter every 2 seconds and publishes the counter value via the interface attribute <code>x</code>.</p></div>
<div class="paragraph"><p>Now see the implementation of the client. The simplest case is to get the current value of <code>x</code>. The following extract shows one part of the main function:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;CommonAPI/CommonAPI.hpp&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;CommonAPI/Extensions/AttributeCacheExtension.hpp&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;v1/commonapi/examples/E02AttributesProxy.hpp&gt;</span>
<span style="font-weight: bold"><span style="color: #0000FF">using</span></span> <span style="font-weight: bold"><span style="color: #0000FF">namespace</span></span> v1<span style="color: #990000">::</span>commonapi<span style="color: #990000">::</span>examples<span style="color: #990000">;</span>

<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">recv_cb</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> CommonAPI<span style="color: #990000">::</span>CallStatus<span style="color: #990000">&amp;</span> callStatus<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> int32_t<span style="color: #990000">&amp;</span> val<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Receive callback: "</span> <span style="color: #990000">&lt;&lt;</span> val <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">recv_cb_s</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> CommonAPI<span style="color: #990000">::</span>CallStatus<span style="color: #990000">&amp;</span> callStatus<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> CommonTypes<span style="color: #990000">::</span>a1Struct<span style="color: #990000">&amp;</span> valStruct<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Receive callback for structure: a1.s = "</span> <span style="color: #990000">&lt;&lt;</span> valStruct<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getS</span></span><span style="color: #990000">()</span>
              <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">", valStruct.a2.b = "</span> <span style="color: #990000">&lt;&lt;</span> <span style="color: #990000">(</span>valStruct<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getA2</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">getB</span></span><span style="color: #990000">()</span> <span style="color: #990000">?</span> <span style="color: #FF0000">"TRUE"</span> <span style="color: #990000">:</span> <span style="color: #FF0000">"FALSE"</span><span style="color: #990000">)</span>
              <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">", valStruct.a2.d = "</span> <span style="color: #990000">&lt;&lt;</span> valStruct<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getA2</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">getD</span></span><span style="color: #990000">()</span>
              <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    std<span style="color: #990000">::</span>shared_ptr <span style="color: #990000">&lt;</span> CommonAPI<span style="color: #990000">::</span>Runtime <span style="color: #990000">&gt;</span> runtime <span style="color: #990000">=</span> CommonAPI<span style="color: #990000">::</span>Runtime<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">();</span>

    std<span style="color: #990000">::</span><span style="color: #008080">string</span> domain <span style="color: #990000">=</span> <span style="color: #FF0000">"local"</span><span style="color: #990000">;</span>
    std<span style="color: #990000">::</span><span style="color: #008080">string</span> instance <span style="color: #990000">=</span> <span style="color: #FF0000">"commonapi.examples.Attributes"</span><span style="color: #990000">;</span>
    std<span style="color: #990000">::</span><span style="color: #008080">string</span> connection <span style="color: #990000">=</span> <span style="color: #FF0000">"client-sample"</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">auto</span></span> myProxy <span style="color: #990000">=</span> runtime<span style="color: #990000">-&gt;</span>buildProxyWithDefaultAttributeExtension<span style="color: #990000">&lt;</span>E02AttributesProxy<span style="color: #990000">,</span> CommonAPI<span style="color: #990000">::</span>Extensions<span style="color: #990000">::</span>AttributeCacheExtension<span style="color: #990000">&gt;(</span>domain<span style="color: #990000">,</span> instance<span style="color: #990000">,</span> connection<span style="color: #990000">);</span>

    std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Waiting for service to become available."</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(!</span>myProxy<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">isAvailable</span></span><span style="color: #990000">())</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>this_thread<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">sleep_for</span></span><span style="color: #990000">(</span>std<span style="color: #990000">::</span>chrono<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">microseconds</span></span><span style="color: #990000">(</span><span style="color: #993399">10</span><span style="color: #990000">));</span>
    <span style="color: #FF0000">}</span>
    CommonAPI<span style="color: #990000">::</span><span style="color: #008080">CallStatus</span> callStatus<span style="color: #990000">;</span>

    <span style="color: #008080">int32_t</span> value <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>

    CommonAPI<span style="color: #990000">::</span><span style="color: #008080">CallInfo</span> <span style="font-weight: bold"><span style="color: #000000">info</span></span><span style="color: #990000">(</span><span style="color: #993399">1000</span><span style="color: #990000">);</span>
    info<span style="color: #990000">.</span>sender_ <span style="color: #990000">=</span> <span style="color: #993399">5678</span><span style="color: #990000">;</span>

    <span style="font-style: italic"><span style="color: #9A1900">// Get actual attribute value from service</span></span>
    std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Getting attribute value: "</span> <span style="color: #990000">&lt;&lt;</span> value <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    myProxy<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getXAttribute</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">getValue</span></span><span style="color: #990000">(</span>callStatus<span style="color: #990000">,</span> value<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>info<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>callStatus <span style="color: #990000">!=</span> CommonAPI<span style="color: #990000">::</span>CallStatus<span style="color: #990000">::</span>SUCCESS<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cerr <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Remote call A failed!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Got attribute value: "</span> <span style="color: #990000">&lt;&lt;</span> value <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>

    <span style="font-style: italic"><span style="color: #9A1900">// Subscribe for receiving values</span></span>
    myProxy<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getXAttribute</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">getChangedEvent</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">subscribe</span></span><span style="color: #990000">([&amp;](</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> int32_t<span style="color: #990000">&amp;</span> val<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received change message: "</span> <span style="color: #990000">&lt;&lt;</span> val <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span><span style="color: #990000">);</span>

    myProxy<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getA1Attribute</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">getChangedEvent</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">subscribe</span></span><span style="color: #990000">([&amp;](</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> CommonTypes<span style="color: #990000">::</span>a1Struct<span style="color: #990000">&amp;</span> val<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received change message for A1"</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span><span style="color: #990000">);</span>

    value <span style="color: #990000">=</span> <span style="color: #993399">100</span><span style="color: #990000">;</span>

    <span style="font-style: italic"><span style="color: #9A1900">// Asynchronous call to set attribute of service</span></span>
    std<span style="color: #990000">::</span><span style="color: #008080">function&lt;void(const CommonAPI::CallStatus&amp;, int32_t)&gt;</span> fcb <span style="color: #990000">=</span> recv_cb<span style="color: #990000">;</span>
    myProxy<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getXAttribute</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">setValueAsync</span></span><span style="color: #990000">(</span>value<span style="color: #990000">,</span> fcb<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>info<span style="color: #990000">);</span>

    <span style="font-style: italic"><span style="color: #9A1900">// Asynchronous call to set attribute of type structure in service</span></span>
    CommonTypes<span style="color: #990000">::</span><span style="color: #008080">a1Struct</span> valueStruct<span style="color: #990000">;</span>

    valueStruct<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setS</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"abc"</span><span style="color: #990000">);</span>
    CommonTypes<span style="color: #990000">::</span><span style="color: #008080">a2Struct</span> a2Struct <span style="color: #990000">=</span> valueStruct<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getA2</span></span><span style="color: #990000">();</span>
    a2Struct<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setA</span></span><span style="color: #990000">(</span><span style="color: #993399">123</span><span style="color: #990000">);</span>
    a2Struct<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setB</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">);</span>
    a2Struct<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setD</span></span><span style="color: #990000">(</span><span style="color: #993399">1234</span><span style="color: #990000">);</span>
    valueStruct<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setA2</span></span><span style="color: #990000">(</span>a2Struct<span style="color: #990000">);</span>

    std<span style="color: #990000">::</span><span style="color: #008080">function&lt;void(const CommonAPI::CallStatus&amp;, CommonTypes::a1Struct)&gt;</span> fcb_s <span style="color: #990000">=</span> recv_cb_s<span style="color: #990000">;</span>
    myProxy<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getA1Attribute</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">setValueAsync</span></span><span style="color: #990000">(</span>valueStruct<span style="color: #990000">,</span> fcb_s<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>info<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="color: #008080">int32_t</span> errorValue <span style="color: #990000">=</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">;</span>
        <span style="color: #008080">int32_t</span> valueCached <span style="color: #990000">=</span> <span style="color: #990000">*</span>myProxy<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getXAttributeExtension</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">getCachedValue</span></span><span style="color: #990000">(</span>errorValue<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>valueCached <span style="color: #990000">!=</span> errorValue<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Got cached attribute value["</span> <span style="color: #990000">&lt;&lt;</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span>valueCached <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"]: "</span> <span style="color: #990000">&lt;&lt;</span> valueCached <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
            std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Got cached attribute error value["</span> <span style="color: #990000">&lt;&lt;</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span>valueCached <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"]: "</span> <span style="color: #990000">&lt;&lt;</span> valueCached <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        std<span style="color: #990000">::</span>this_thread<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">sleep_for</span></span><span style="color: #990000">(</span>std<span style="color: #990000">::</span>chrono<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">microseconds</span></span><span style="color: #990000">(</span><span style="color: #993399">1000000</span><span style="color: #990000">));</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The <code>getXAttribute</code> method will deliver the type <code>XAttribute</code> which has to be used for the access to <code>x</code>. Every access returns a flag named callStatus (please see the CommonAPI specification). Subscription requires in general the definition of a callback function which is called in case of an attribute change. The subscribe method of CommonAPI requires a function object; for a compact notation this function object can be defined as lambda function.</p></div>
<div class="paragraph"><p>Of course it is also possible to define a separate callback function with an user-defined name (here recv_cb) as can be seen at the asynchronous set call for the attribute <code>x</code>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">recv_cb</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> CommonAPI<span style="color: #990000">::</span>CallStatus<span style="color: #990000">&amp;</span> callStatus<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> int32_t<span style="color: #990000">&amp;</span> val<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Receive callback: "</span> <span style="color: #990000">&lt;&lt;</span> val <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #990000">....</span> <span style="font-style: italic"><span style="color: #9A1900">// main method</span></span>

value <span style="color: #990000">=</span> <span style="color: #993399">100</span><span style="color: #990000">;</span>
<span style="font-style: italic"><span style="color: #9A1900">// Asynchronous call to set attribute of service</span></span>
std<span style="color: #990000">::</span><span style="color: #008080">function&lt;void(const CommonAPI::CallStatus&amp;, int32_t)&gt;</span> fcb <span style="color: #990000">=</span> recv_cb<span style="color: #990000">;</span>
myProxy<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getXAttribute</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">setValueAsync</span></span><span style="color: #990000">(</span>value<span style="color: #990000">,</span> fcb<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>info<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>This example uses a special feature of CommonAPI which is called <em>Attribute Extension</em>. This feature is described separately. At this point we do not want to go into more detail. Please see the source code of the example for a deeper insight.</p></div>
</div>
<div class="sect2">
<h3 id="_example_03_methods">Example 03: Methods</h3>
<div class="paragraph"><p>Franca attributes represent status variables or data sets of services which shall be accessible by the clients of the service. In contrast, methods can be used for example to start a process in the service or to query for certain information (e.g., from a database). See the following example 3:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">package</span></span> commonapi<span style="color: #990000">.</span>examples

<span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">E03Methods</span> <span style="color: #FF0000">{</span>

    version <span style="color: #FF0000">{</span> major <span style="color: #993399">1</span> minor <span style="color: #993399">2</span> <span style="color: #FF0000">}</span>

    <span style="color: #008080">method</span> foo <span style="color: #FF0000">{</span>
        in <span style="color: #FF0000">{</span>
            Int32 x1
            String x2
        <span style="color: #FF0000">}</span>
        out <span style="color: #FF0000">{</span>
            Int32 y1
            String y2
        <span style="color: #FF0000">}</span>
        error <span style="color: #FF0000">{</span>
            stdErrorTypeEnum
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>

    <span style="color: #008080">broadcast</span> myStatus <span style="color: #FF0000">{</span>
        out <span style="color: #FF0000">{</span>
            Int32 myCurrentValue
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>

    <span style="color: #008080">enumeration</span> stdErrorTypeEnum <span style="color: #FF0000">{</span>
        NO_FAULT
        MY_FAULT
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Basically Franca methods have input parameters and output parameters and can return an optional application error which reports for example if the started process in the service could be finished successfully or not. Input and output parameters can have arbitrarily complex types, a separate definition of so-called InOut arguments of functions was not considered necessary.</p></div>
<div class="paragraph"><p>A special case are broadcasts. They can be used like readonly attributes. But there are several output parameters allowed (and no input parameters). Another difference is the additional optional keyword selective, which indicates that only selected clients can register on the broadcast see example 4).</p></div>
<div class="paragraph"><p>Another optional keyword (only for methods) is fireAndForget which indicates that neither return values nor a call status is expected.</p></div>
<div class="paragraph"><p>The implementation of the service class is straight:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">void</span> E03MethodsStubImpl<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">foo</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> std<span style="color: #990000">::</span><span style="color: #008080">shared_ptr&lt;CommonAPI::ClientId&gt;</span> _client<span style="color: #990000">,</span>
                <span style="color: #008080">int32_t</span> _x1<span style="color: #990000">,</span>
                std<span style="color: #990000">::</span><span style="color: #008080">string</span> _x2<span style="color: #990000">,</span>
                <span style="color: #008080">fooReply_t</span> _reply<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>


    E03Methods<span style="color: #990000">::</span><span style="color: #008080">fooError</span> methodError <span style="color: #990000">=</span> <span style="color: #990000">(</span>E03Methods<span style="color: #990000">::</span>fooError<span style="color: #990000">)</span>

    E03Methods<span style="color: #990000">::</span>stdErrorTypeEnum<span style="color: #990000">::</span>MY_FAULT<span style="color: #990000">;</span>
    <span style="color: #008080">int32_t</span> y1 <span style="color: #990000">=</span> <span style="color: #993399">42</span><span style="color: #990000">;</span>
    std<span style="color: #990000">::</span><span style="color: #008080">string</span> y2 <span style="color: #990000">=</span> <span style="color: #FF0000">"xyz"</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">_reply</span></span><span style="color: #990000">(</span>methodError<span style="color: #990000">,</span> y1<span style="color: #990000">,</span> y2<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The input parameters are available as values, the output parameter are wrapped in a generated reply object with the type fooReply_t. This is slightly different to earlier versions of CommonAPI where the return values were passed as references.</p></div>
<div class="paragraph"><p>In the example there is another function incCounter implemented which sends the broadcast myStatus via the generated method fireMyStatusEvent:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">void</span> E03MethodsStubImpl<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">incCounter</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    cnt<span style="color: #990000">++;</span>
    <span style="font-weight: bold"><span style="color: #000000">fireMyStatusEvent</span></span><span style="color: #990000">((</span>int32_t<span style="color: #990000">)</span> cnt<span style="color: #990000">);</span>
    std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"New counter value = "</span> <span style="color: #990000">&lt;&lt;</span> cnt <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"!"</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The subscription to the broadcast is nearly identical to the subscription to the change of the value of an attribute. The example shows further an asynchronous and a synchronous call of the function foo; in the asynchronous case the callback function <code>recv_cb</code> is defined.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;iostream&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;unistd.h&gt;</span>

<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;CommonAPI/CommonAPI.hpp&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;v1/commonapi/examples/E03MethodsProxy.hpp&gt;</span>

<span style="font-weight: bold"><span style="color: #0000FF">using</span></span> <span style="font-weight: bold"><span style="color: #0000FF">namespace</span></span> v1_2<span style="color: #990000">::</span>commonapi<span style="color: #990000">::</span>examples<span style="color: #990000">;</span>

<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">recv_cb</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> CommonAPI<span style="color: #990000">::</span>CallStatus<span style="color: #990000">&amp;</span> callStatus<span style="color: #990000">,</span>
             <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> E03Methods<span style="color: #990000">::</span>stdErrorTypeEnum<span style="color: #990000">&amp;</span> methodError<span style="color: #990000">,</span>
             <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> int32_t<span style="color: #990000">&amp;</span> y1<span style="color: #990000">,</span>
             <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> std<span style="color: #990000">::</span>string<span style="color: #990000">&amp;</span> y2<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Result of asynchronous call of foo: "</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"   callStatus: "</span> <span style="color: #990000">&lt;&lt;</span> <span style="color: #990000">((</span>callStatus <span style="color: #990000">==</span> CommonAPI<span style="color: #990000">::</span>CallStatus<span style="color: #990000">::</span>SUCCESS<span style="color: #990000">)</span> <span style="color: #990000">?</span> <span style="color: #FF0000">"SUCCESS"</span> <span style="color: #990000">:</span> <span style="color: #FF0000">"NO_SUCCESS"</span><span style="color: #990000">)</span>
                    <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"   error: "</span>
                    <span style="color: #990000">&lt;&lt;</span> <span style="color: #990000">((</span>methodError <span style="color: #990000">==</span> E03Methods<span style="color: #990000">::</span>stdErrorTypeEnum<span style="color: #990000">::</span>NO_FAULT<span style="color: #990000">)</span> <span style="color: #990000">?</span> <span style="color: #FF0000">"NO_FAULT"</span> <span style="color: #990000">:</span>
                                    <span style="color: #FF0000">"MY_FAULT"</span><span style="color: #990000">)</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"   Output values: y1 = "</span> <span style="color: #990000">&lt;&lt;</span> y1 <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">", y2 = "</span> <span style="color: #990000">&lt;&lt;</span> y2 <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    CommonAPI<span style="color: #990000">::</span>Runtime<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">setProperty</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"LogContext"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"E03C"</span><span style="color: #990000">);</span>
    CommonAPI<span style="color: #990000">::</span>Runtime<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">setProperty</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"LibraryBase"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"E03Methods"</span><span style="color: #990000">);</span>

    std<span style="color: #990000">::</span><span style="color: #008080">shared_ptr&lt;CommonAPI::Runtime&gt;</span> runtime <span style="color: #990000">=</span> CommonAPI<span style="color: #990000">::</span>Runtime<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">();</span>

    std<span style="color: #990000">::</span><span style="color: #008080">string</span> domain <span style="color: #990000">=</span> <span style="color: #FF0000">"local"</span><span style="color: #990000">;</span>
    std<span style="color: #990000">::</span><span style="color: #008080">string</span> instance <span style="color: #990000">=</span> <span style="color: #FF0000">"commonapi.examples.Methods"</span><span style="color: #990000">;</span>

    std<span style="color: #990000">::</span><span style="color: #008080">shared_ptr&lt;E03MethodsProxy&lt;&gt;&gt;</span> myProxy <span style="color: #990000">=</span> runtime<span style="color: #990000">-&gt;</span>buildProxy <span style="color: #990000">&lt;</span> E03MethodsProxy <span style="color: #990000">&gt;</span> <span style="color: #990000">(</span>domain<span style="color: #990000">,</span> instance<span style="color: #990000">,</span> <span style="color: #FF0000">"client-sample"</span><span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(!</span>myProxy<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">isAvailable</span></span><span style="color: #990000">())</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>this_thread<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">sleep_for</span></span><span style="color: #990000">(</span>std<span style="color: #990000">::</span>chrono<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">microseconds</span></span><span style="color: #990000">(</span><span style="color: #993399">10</span><span style="color: #990000">));</span>
    <span style="color: #FF0000">}</span>

    <span style="font-style: italic"><span style="color: #9A1900">// Subscribe to broadcast</span></span>
    myProxy<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getMyStatusEvent</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">subscribe</span></span><span style="color: #990000">([&amp;](</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> int32_t<span style="color: #990000">&amp;</span> val<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received status event: "</span> <span style="color: #990000">&lt;&lt;</span> val <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span><span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="color: #008080">int32_t</span> inX1 <span style="color: #990000">=</span> <span style="color: #993399">5</span><span style="color: #990000">;</span>
        std<span style="color: #990000">::</span><span style="color: #008080">string</span> inX2 <span style="color: #990000">=</span> <span style="color: #FF0000">"abc"</span><span style="color: #990000">;</span>
        CommonAPI<span style="color: #990000">::</span><span style="color: #008080">CallStatus</span> callStatus<span style="color: #990000">;</span>
        E03Methods<span style="color: #990000">::</span><span style="color: #008080">stdErrorTypeEnum</span> methodError<span style="color: #990000">;</span>
        <span style="color: #008080">int32_t</span> outY1<span style="color: #990000">;</span>
        std<span style="color: #990000">::</span><span style="color: #008080">string</span> outY2<span style="color: #990000">;</span>

        <span style="font-style: italic"><span style="color: #9A1900">// Synchronous call</span></span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Call foo with synchronous semantics ..."</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
        myProxy<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">foo</span></span><span style="color: #990000">(</span>inX1<span style="color: #990000">,</span> inX2<span style="color: #990000">,</span> callStatus<span style="color: #990000">,</span> methodError<span style="color: #990000">,</span> outY1<span style="color: #990000">,</span> outY2<span style="color: #990000">);</span>

        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Result of synchronous call of foo: "</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"   callStatus: "</span> <span style="color: #990000">&lt;&lt;</span> <span style="color: #990000">((</span>callStatus <span style="color: #990000">==</span> CommonAPI<span style="color: #990000">::</span>CallStatus<span style="color: #990000">::</span>SUCCESS<span style="color: #990000">)</span> <span style="color: #990000">?</span> <span style="color: #FF0000">"SUCCESS"</span> <span style="color: #990000">:</span> <span style="color: #FF0000">"NO_SUCCESS"</span><span style="color: #990000">)</span>
                  <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"   error: "</span>
                  <span style="color: #990000">&lt;&lt;</span> <span style="color: #990000">((</span>methodError <span style="color: #990000">==</span> E03Methods<span style="color: #990000">::</span>stdErrorTypeEnum<span style="color: #990000">::</span>NO_FAULT<span style="color: #990000">)</span> <span style="color: #990000">?</span> <span style="color: #FF0000">"NO_FAULT"</span> <span style="color: #990000">:</span> <span style="color: #FF0000">"MY_FAULT"</span><span style="color: #990000">)</span>
                  <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"   Input values: x1 = "</span> <span style="color: #990000">&lt;&lt;</span> inX1 <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">", x2 = "</span> <span style="color: #990000">&lt;&lt;</span> inX2 <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"   Output values: y1 = "</span> <span style="color: #990000">&lt;&lt;</span> outY1 <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">", y2 = "</span> <span style="color: #990000">&lt;&lt;</span> outY2 <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>

        <span style="font-style: italic"><span style="color: #9A1900">// Asynchronous call</span></span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Call foo with asynchronous semantics ..."</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>

        std<span style="color: #990000">::</span>function<span style="color: #990000">&lt;</span>
                        <span style="color: #009900">void</span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> CommonAPI<span style="color: #990000">::</span>CallStatus<span style="color: #990000">&amp;,</span>
                             <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> E03Methods<span style="color: #990000">::</span>stdErrorTypeEnum<span style="color: #990000">&amp;,</span>
                             <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> int32_t<span style="color: #990000">&amp;,</span>
                             <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> std<span style="color: #990000">::</span>string<span style="color: #990000">&amp;)&gt;</span> fcb <span style="color: #990000">=</span> recv_cb<span style="color: #990000">;</span>
        myProxy<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">fooAsync</span></span><span style="color: #990000">(</span>inX1<span style="color: #990000">,</span> inX2<span style="color: #990000">,</span> recv_cb<span style="color: #990000">);</span>

        std<span style="color: #990000">::</span>this_thread<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">sleep_for</span></span><span style="color: #990000">(</span>std<span style="color: #990000">::</span>chrono<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">seconds</span></span><span style="color: #990000">(</span><span style="color: #993399">5</span><span style="color: #990000">));</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>A frequently asked question is what happens if the service does not answer. In this case, the callback function <code>recv_cb</code> is called anyway, but the <code>callStatus</code> has the value <code>REMOTE_ERROR</code>. It is however the responsibility of the specific middleware to implement this behavior. The CommonAPI specification says:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>NOT</strong> considered to be a remote error is an application level error that is defined in the corresponding Franca interface, because from the point of view of the transport layer the service still returned a valid answer.
</p>
</li>
<li>
<p>
It <strong>IS</strong> considered to be a remote error if no answer for a sent remote method call is returned within a defined time. It is discouraged to allow the sending of any method calls without a defined timeout. This timeout may be middleware specific. This timeout may also be configurable by means of a Franca Deployment Model. It is <strong>NOT</strong> configurable at runtime by means of the Common API.
</p>
</li>
</ul></div>
<div class="paragraph"><p>The timeout of function calls can be set by the optional <code>CallInfo</code> argument on client side.</p></div>
</div>
<div class="sect2">
<h3 id="_example_04_phonebook">Example 04: PhoneBook</h3>
<div class="paragraph"><p>This slightly more complex example illustrates the application of some Franca features in combination with CommonAPI:</p></div>
<div class="ulist"><ul>
<li>
<p>
explicit named arrays and inline arrays
</p>
</li>
<li>
<p>
selective broadcasts
</p>
</li>
<li>
<p>
polymorphic structs
</p>
</li>
</ul></div>
<div class="paragraph"><p>Concerning arrays please note the following points:</p></div>
<div class="ulist"><ul>
<li>
<p>
In Franca there are two ways to define arrays: explicitly named (array myArray of UInt8) or implicit without defining a new name for the array (UInt8 []).
</p>
</li>
<li>
<p>
The implicit definition of multidimensional arrays is not possible at the moment (like UInt8 [][]), but multidimensional arrays can be defined with explicit names.
</p>
</li>
<li>
<p>
In CommonAPI arrays are implemented and generated as std::vector.
</p>
</li>
</ul></div>
<div class="paragraph"><p>A common problem in the specification of interfaces between user frontends and services which contain large data sets is, that the clients usually need only extracts from the database. That means that only a filtered excerpt from the database has to be transmitted via IPC to the client, but probably every client needs a different excerpt. The filter can affect the selection of the elements (element filter), the contents of the elements (content filter) or the number of elements (array window).</p></div>
<div class="paragraph"><p>The following example shows how different extracts of a central data array can be accessed by several clients via a data filter mechanism and selective broadcasts. As example of a central data array a phone book is selected; the following picture shows the basic content of the example.</p></div>
<div class="imageblock">
<div class="content">
<img src="../images/E04PhoneBook.png" alt="PhoneBookExample image" />
</div>
</div>
<div class="paragraph"><p>The Franca IDL specification is:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">package</span></span> commonapi<span style="color: #990000">.</span>examples

<span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">E04PhoneBook</span> <span style="color: #FF0000">{</span>
    version <span style="color: #FF0000">{</span> major <span style="color: #993399">0</span> minor <span style="color: #993399">0</span> <span style="color: #FF0000">}</span>

    <span style="color: #990000">&lt;**</span> @description <span style="color: #990000">:</span> the phone <span style="color: #008080">book</span> itself <span style="color: #990000">**&gt;</span>
    <span style="color: #008080">attribute</span> phoneBookStruct <span style="color: #990000">[]</span> phoneBook readonly

    <span style="color: #990000">&lt;**</span> @description <span style="color: #990000">:</span> <span style="color: #008080">filter</span> operations <span style="color: #990000">**&gt;</span>
    <span style="color: #008080">method</span> setPhoneBookDataFilter <span style="color: #FF0000">{</span>
        in <span style="color: #FF0000">{</span>
            elementFilterStruct elementFilter
            contentFilterStruct <span style="color: #990000">[]</span> contentFilter
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>

    <span style="color: #990000">&lt;**</span> @description <span style="color: #990000">:</span> <span style="color: #008080">filter</span> result <span style="color: #990000">**&gt;</span>
    broadcast <span style="color: #008080">phoneBookDataSet</span> selective <span style="color: #FF0000">{</span>
        out <span style="color: #FF0000">{</span>
            phoneBookDataElementMap <span style="color: #990000">[]</span> phoneBookDataSet
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>

    <span style="color: #990000">&lt;**</span> @description <span style="color: #990000">:</span> Data types of the phone <span style="color: #008080">book</span> itself <span style="color: #990000">**&gt;</span>
    <span style="color: #008080">enumeration</span> phoneNumberEnum <span style="color: #FF0000">{</span>
        WORK
        HOME
        MOBILE1
        MOBILE2
    <span style="color: #FF0000">}</span>

    <span style="color: #008080">map</span> phoneNumberMap <span style="color: #FF0000">{</span>
        phoneNumberEnum to String
    <span style="color: #FF0000">}</span>

    <span style="color: #008080">struct</span> phoneBookStruct <span style="color: #FF0000">{</span>
        String name
        String forename
        String organisation
        String address
        String email
        phoneNumberMap phoneNumber
    <span style="color: #FF0000">}</span>

    <span style="color: #990000">&lt;**</span> @description <span style="color: #990000">:</span> Data types <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> the <span style="color: #008080">filter</span> operations <span style="color: #990000">**&gt;</span>

    <span style="color: #008080">struct</span> elementFilterStruct <span style="color: #FF0000">{</span>
        Boolean addName
        Boolean addForename
        Boolean addOrganisation
        Boolean addAddress
        Boolean addEmail
        Boolean addPhoneNumber
    <span style="color: #FF0000">}</span>

    <span style="color: #008080">struct</span> contentFilterStruct <span style="color: #FF0000">{</span>
        phoneBookDataElementEnum element
        String expression
    <span style="color: #FF0000">}</span>

    <span style="color: #990000">&lt;**</span> @description <span style="color: #990000">:</span> Data types <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> the result of the phone <span style="color: #008080">book</span> filter <span style="color: #990000">**&gt;</span>
    <span style="color: #008080">enumeration</span> phoneBookDataElementEnum <span style="color: #FF0000">{</span>
        NAME
        FORENAME
        ORGANISATION
        ADDRESS
        EMAIL
        PHONENUMBER
    <span style="color: #FF0000">}</span>

    struct <span style="color: #008080">phoneBookDataElement</span> polymorphic <span style="color: #FF0000">{</span>
    <span style="color: #FF0000">}</span>

    struct phoneBookDataElementString <span style="color: #008080">extends</span> phoneBookDataElement <span style="color: #FF0000">{</span>
        String content
    <span style="color: #FF0000">}</span>

    struct phoneBookDataElementPhoneNumber <span style="color: #008080">extends</span> phoneBookDataElement <span style="color: #FF0000">{</span>
        phoneNumberMap content
    <span style="color: #FF0000">}</span>

    <span style="color: #008080">map</span> phoneBookDataElementMap <span style="color: #FF0000">{</span>
        phoneBookDataElementEnum to phoneBookDataElement
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The phone book itself is modeled as an attribute which is an array of the structure <code>phoneBookStruct</code>. Here the phone book is <code>readonly</code>, that means that the whole content can be accessed only via subscription and the getter function. A special difficulty is the phone number, because there are several kinds of phone numbers allowed (home, mobile, &#8230;). Therefore the element <code>phoneNumber</code> in <code>phoneBookStruct</code> is a map with an enumeration key and a value of type string for the number. The client can set a filter to the phone book data (in the example only content filter and element filter, but other filters are conceivable) via the method <code>setPhoneBookDataFilter</code> and gets the data back via the selective broadcast <code>phoneBookDataSet</code>. Since the content of the data set depends on the filter, the elements of the client specific data set are specified as maps where the key is the type of the element (name, forename, &#8230;) and the value is the content of the element. The content can be of the type String or of the user defined type phoneNumberMap. Therefore the value is defined as polymorphic struct which can be a String or a phoneNumberMap.</p></div>
<div class="paragraph"><p>In the following we consider only some interesting implementation details, for the complete implementation please see the source code.</p></div>
<div class="paragraph"><p>The interesting part of the service is the implementation of the set function for the data filter. At the moment only the element filter is implemented, but the implementation of the other filters can be added analogously.</p></div>
<div class="ulist"><ul>
<li>
<p>
Each client is identified via its client ID (<code>ClientId</code>); the implementation of client ID class allows the usage of client ID objects as key in a map (see the specification).
</p>
</li>
<li>
<p>
The data sets of the filtered data for the clients are stored in a map with the client ID as key; in this example the filtered data are sent back to the client directly in the filter set function. Please note, that <code>firePhoneBookDataSetSelective</code> sends the data to only one receiver.
</p>
</li>
<li>
<p>
The value of the key has to be the right type (<code>phoneNumberMap</code> for phoneNumbers and Strings for the rest).
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">void</span> E04PhoneBookStubImpl<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">setPhoneBookDataFilter</span></span><span style="color: #990000">(</span>
            <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> std<span style="color: #990000">::</span><span style="color: #008080">shared_ptr&lt;CommonAPI::ClientId&gt;</span> _client<span style="color: #990000">,</span>
            E04PhoneBook<span style="color: #990000">::</span><span style="color: #008080">elementFilterStruct</span> _elementFilter<span style="color: #990000">,</span>
            std<span style="color: #990000">::</span><span style="color: #008080">vector&lt;E04PhoneBook::contentFilterStruct&gt;</span> _contentFilter<span style="color: #990000">,</span>
            <span style="color: #008080">setPhoneBookDataFilterReply_t</span> _reply<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>

    std<span style="color: #990000">::</span>shared_ptr <span style="color: #990000">&lt;</span> CommonAPI<span style="color: #990000">::</span>ClientIdList <span style="color: #990000">&gt;</span> clientList <span style="color: #990000">=</span>
            <span style="font-weight: bold"><span style="color: #000000">getSubscribersForPhoneBookDataSetSelective</span></span><span style="color: #990000">();</span>

    std<span style="color: #990000">::</span>vector <span style="color: #990000">&lt;</span> E04PhoneBook<span style="color: #990000">::</span>phoneBookDataElementMap <span style="color: #990000">&gt;</span> lPhoneBookDataSet<span style="color: #990000">;</span>

    phoneBookClientData<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">erase</span></span><span style="color: #990000">(</span>_client<span style="color: #990000">);</span>

    std<span style="color: #990000">::</span>vector<span style="color: #990000">&lt;</span>E04PhoneBook<span style="color: #990000">::</span>phoneBookStruct<span style="color: #990000">&gt;::</span><span style="color: #008080">const_iterator</span> it0<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>it0 <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">getPhoneBookAttribute</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">begin</span></span><span style="color: #990000">();</span> it0 <span style="color: #990000">!=</span> <span style="font-weight: bold"><span style="color: #000000">getPhoneBookAttribute</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">end</span></span><span style="color: #990000">();</span> it0<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>

        E04PhoneBook<span style="color: #990000">::</span><span style="color: #008080">phoneBookDataElementMap</span> lPhoneBookDataElement<span style="color: #990000">;</span>

        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_elementFilter<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getAddName</span></span><span style="color: #990000">())</span> <span style="color: #FF0000">{</span>
            std<span style="color: #990000">::</span><span style="color: #008080">shared_ptr&lt;E04PhoneBook::phoneBookDataElementString&gt;</span> name <span style="color: #990000">=</span>
                std<span style="color: #990000">::</span>make_shared<span style="color: #990000">&lt;</span>E04PhoneBook<span style="color: #990000">::</span>phoneBookDataElementString<span style="color: #990000">&gt;();</span>
            name<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">setContent</span></span><span style="color: #990000">(</span>it0<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getName</span></span><span style="color: #990000">());</span>
            lPhoneBookDataElement<span style="color: #990000">[</span>E04PhoneBook<span style="color: #990000">::</span>phoneBookDataElementEnum<span style="color: #990000">::</span>NAME<span style="color: #990000">]</span> <span style="color: #990000">=</span> name<span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>

        <span style="font-style: italic"><span style="color: #9A1900">/*  ... Similar for all other elements */</span></span>

        lPhoneBookDataSet<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">push_back</span></span><span style="color: #990000">(</span>lPhoneBookDataElement<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>

    phoneBookClientData<span style="color: #990000">[</span>_client<span style="color: #990000">]</span> <span style="color: #990000">=</span> lPhoneBookDataSet<span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> std<span style="color: #990000">::</span><span style="color: #008080">shared_ptr&lt;CommonAPI::ClientIdList&gt;</span> <span style="font-weight: bold"><span style="color: #000000">receivers</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">new</span></span> CommonAPI<span style="color: #990000">::</span>ClientIdList<span style="color: #990000">);</span>
    receivers<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">insert</span></span><span style="color: #990000">(</span>_client<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">firePhoneBookDataSetSelective</span></span><span style="color: #990000">(</span>lPhoneBookDataSet<span style="color: #990000">,</span> receivers<span style="color: #990000">);</span>

    receivers<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">erase</span></span><span style="color: #990000">(</span>_client<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">_reply</span></span><span style="color: #990000">();</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>On client side we create two proxies which shall set different filters and get different data sets. With CommonAPI 2.x we needed two different factories for these two proxies; this can be achieved by now by creating a new Connection ID for the second proxy. Each proxy has to subscribe to phoneBookDataSet, but gets different contents depending on the filter. The whole phoneBookData can be obtained via the standard get function.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    CommonAPI<span style="color: #990000">::</span>Runtime<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">setProperty</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"LogContext"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"E04C"</span><span style="color: #990000">);</span>
    CommonAPI<span style="color: #990000">::</span>Runtime<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">setProperty</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"LibraryBase"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"E04PhoneBook"</span><span style="color: #990000">);</span>

    std<span style="color: #990000">::</span><span style="color: #008080">shared_ptr&lt;CommonAPI::Runtime&gt;</span> runtime <span style="color: #990000">=</span> CommonAPI<span style="color: #990000">::</span>Runtime<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">();</span>

    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> std<span style="color: #990000">::</span><span style="color: #008080">string</span> <span style="color: #990000">&amp;</span>domain <span style="color: #990000">=</span> <span style="color: #FF0000">"local"</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> std<span style="color: #990000">::</span><span style="color: #008080">string</span> <span style="color: #990000">&amp;</span>instance <span style="color: #990000">=</span> <span style="color: #FF0000">"commonapi.examples.PhoneBook"</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> std<span style="color: #990000">::</span><span style="color: #008080">string</span> <span style="color: #990000">&amp;</span>connection <span style="color: #990000">=</span> <span style="color: #FF0000">"client-sample"</span><span style="color: #990000">;</span>

    std<span style="color: #990000">::</span>shared_ptr <span style="color: #990000">&lt;</span> <span style="color: #008080">E04PhoneBookProxy&lt;&gt; &gt;</span> myProxyA <span style="color: #990000">=</span> runtime<span style="color: #990000">-&gt;</span>buildProxy <span style="color: #990000">&lt;</span> E04PhoneBookProxy <span style="color: #990000">&gt;</span> <span style="color: #990000">(</span>domain<span style="color: #990000">,</span> instance<span style="color: #990000">,</span> connection<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(!</span>myProxyA<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">isAvailable</span></span><span style="color: #990000">())</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>this_thread<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">sleep_for</span></span><span style="color: #990000">(</span>std<span style="color: #990000">::</span>chrono<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">microseconds</span></span><span style="color: #990000">(</span><span style="color: #993399">10</span><span style="color: #990000">));</span>
    <span style="color: #FF0000">}</span>
    std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Service for Proxy A is available!"</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> CommonAPI<span style="color: #990000">::</span><span style="color: #008080">ConnectionId_t</span> otherConnection <span style="color: #990000">=</span> <span style="color: #FF0000">"other-client-sample"</span><span style="color: #990000">;</span>
    std<span style="color: #990000">::</span>shared_ptr <span style="color: #990000">&lt;</span> <span style="color: #008080">E04PhoneBookProxy&lt;&gt; &gt;</span> myProxyB <span style="color: #990000">=</span> runtime<span style="color: #990000">-&gt;</span>buildProxy <span style="color: #990000">&lt;</span> E04PhoneBookProxy <span style="color: #990000">&gt;</span> <span style="color: #990000">(</span>domain<span style="color: #990000">,</span> instance<span style="color: #990000">,</span> otherConnection<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(!</span>myProxyB<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">isAvailable</span></span><span style="color: #990000">())</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>this_thread<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">sleep_for</span></span><span style="color: #990000">(</span>std<span style="color: #990000">::</span>chrono<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">microseconds</span></span><span style="color: #990000">(</span><span style="color: #993399">10</span><span style="color: #990000">));</span>
    <span style="color: #FF0000">}</span>
    std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Service for Proxy B is available!"</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>

    <span style="font-style: italic"><span style="color: #9A1900">// Subscribe A to broadcast</span></span>
    myProxyA<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getPhoneBookDataSetSelectiveEvent</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">subscribe</span></span><span style="color: #990000">(</span>
                    <span style="color: #990000">[&amp;](</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> std<span style="color: #990000">::</span>vector<span style="color: #990000">&lt;</span>E04PhoneBook<span style="color: #990000">::</span>phoneBookDataElementMap<span style="color: #990000">&gt;&amp;</span> phoneBookDataSet<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"-- A --"</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
                        <span style="font-weight: bold"><span style="color: #000000">printFilterResult</span></span><span style="color: #990000">(</span>phoneBookDataSet<span style="color: #990000">,</span> <span style="color: #FF0000">"A"</span><span style="color: #990000">);</span>
                        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"-------"</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
                    <span style="color: #FF0000">}</span><span style="color: #990000">);</span>

    std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Subscribed A"</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>

    <span style="font-style: italic"><span style="color: #9A1900">// Subscribe B to broadcast</span></span>
    myProxyB<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getPhoneBookDataSetSelectiveEvent</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">subscribe</span></span><span style="color: #990000">(</span>
                    <span style="color: #990000">[&amp;](</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> std<span style="color: #990000">::</span>vector<span style="color: #990000">&lt;</span>E04PhoneBook<span style="color: #990000">::</span>phoneBookDataElementMap<span style="color: #990000">&gt;&amp;</span> phoneBookDataSet<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"-- B --"</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
                        <span style="font-weight: bold"><span style="color: #000000">printFilterResult</span></span><span style="color: #990000">(</span>phoneBookDataSet<span style="color: #990000">,</span> <span style="color: #FF0000">"B"</span><span style="color: #990000">);</span>
                        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"-------"</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
                    <span style="color: #FF0000">}</span><span style="color: #990000">);</span>

    std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Subscribed B"</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>

    <span style="font-style: italic"><span style="color: #9A1900">// Get actual phoneBook from service</span></span>
    CommonAPI<span style="color: #990000">::</span><span style="color: #008080">CallStatus</span> myCallStatus<span style="color: #990000">;</span>
    std<span style="color: #990000">::</span><span style="color: #008080">vector&lt;E04PhoneBook::phoneBookStruct&gt;</span> myValue<span style="color: #990000">;</span>

    myProxyA<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getPhoneBookAttribute</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">getValue</span></span><span style="color: #990000">(</span>myCallStatus<span style="color: #990000">,</span> myValue<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>myCallStatus <span style="color: #990000">!=</span> CommonAPI<span style="color: #990000">::</span>CallStatus<span style="color: #990000">::</span>SUCCESS<span style="color: #990000">)</span>
        std<span style="color: #990000">::</span>cerr <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Remote call getPhoneBookAttribute failed!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
        <span style="font-weight: bold"><span style="color: #000000">printPhoneBook</span></span> <span style="color: #990000">(</span>myValue<span style="color: #990000">);</span>

    <span style="font-style: italic"><span style="color: #9A1900">// Synchronous call setPhoneBookDataFilter</span></span>
    std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Call setPhoneBookDataFilter A ..."</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    E04PhoneBook<span style="color: #990000">::</span><span style="color: #008080">elementFilterStruct</span> lElementFilterA <span style="color: #990000">=</span> <span style="color: #FF0000">{</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #FF0000">}</span><span style="color: #990000">;</span>
    std<span style="color: #990000">::</span><span style="color: #008080">vector&lt;E04PhoneBook::contentFilterStruct&gt;</span> lContentFilterA <span style="color: #990000">=</span> <span style="color: #FF0000">{</span> <span style="color: #FF0000">{</span>E04PhoneBook<span style="color: #990000">::</span>phoneBookDataElementEnum<span style="color: #990000">::</span>NAME<span style="color: #990000">,</span> <span style="color: #FF0000">"*"</span><span style="color: #FF0000">}}</span><span style="color: #990000">;</span>

    myProxyA<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">setPhoneBookDataFilter</span></span><span style="color: #990000">(</span>lElementFilterA<span style="color: #990000">,</span> lContentFilterA<span style="color: #990000">,</span> myCallStatus<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>myCallStatus <span style="color: #990000">!=</span> CommonAPI<span style="color: #990000">::</span>CallStatus<span style="color: #990000">::</span>SUCCESS<span style="color: #990000">)</span>
        std<span style="color: #990000">::</span>cerr <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Remote call setPhoneBookDataFilter A failed: "</span> <span style="color: #990000">&lt;&lt;</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span> myCallStatus <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Remote call setPhoneBookDataFilter A succeeded."</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>

    std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Call setPhoneBookDataFilter B ..."</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    E04PhoneBook<span style="color: #990000">::</span><span style="color: #008080">elementFilterStruct</span> lElementFilterB <span style="color: #990000">=</span> <span style="color: #FF0000">{</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #FF0000">}</span><span style="color: #990000">;</span>
    std<span style="color: #990000">::</span><span style="color: #008080">vector&lt;E04PhoneBook::contentFilterStruct&gt;</span> lContentFilterB <span style="color: #990000">=</span> <span style="color: #FF0000">{</span> <span style="color: #FF0000">{</span>E04PhoneBook<span style="color: #990000">::</span>phoneBookDataElementEnum<span style="color: #990000">::</span>NAME<span style="color: #990000">,</span> <span style="color: #FF0000">"*"</span><span style="color: #FF0000">}}</span><span style="color: #990000">;</span>

    myProxyB<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">setPhoneBookDataFilter</span></span><span style="color: #990000">(</span>lElementFilterB<span style="color: #990000">,</span> lContentFilterB<span style="color: #990000">,</span> myCallStatus<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>myCallStatus <span style="color: #990000">!=</span> CommonAPI<span style="color: #990000">::</span>CallStatus<span style="color: #990000">::</span>SUCCESS<span style="color: #990000">)</span>
        std<span style="color: #990000">::</span>cerr <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Remote call setPhoneBookDataFilter B failed: "</span> <span style="color: #990000">&lt;&lt;</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span> myCallStatus <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Remote call setPhoneBookDataFilter B succeeded."</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Now I am going to sleep for 5 seconds..."</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
        std<span style="color: #990000">::</span>this_thread<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">sleep_for</span></span><span style="color: #990000">(</span>std<span style="color: #990000">::</span>chrono<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">seconds</span></span><span style="color: #990000">(</span><span style="color: #993399">5</span><span style="color: #990000">));</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_example_05_managed">Example 05: Managed</h3>
<div class="paragraph"><p>So far we have looked at software systems, which consisted of services and users of these services, the clients. However, in some systems there is a slightly different kind of relationship between the software components: a central manager manages other services (let&#8217;s call them slaves or leaves). This central manager is a service itself but acts as client for the managed services. One example for such a system is, for example, a device manager that manages several devices, which can be available for usage in the system or not. The central manager handles all administrative tasks related to the slaves and provides a central, common interface to the user frontend.</p></div>
<div class="imageblock">
<div class="content">
<img src="../images/E05Manager.png" alt="ManagerExample image" />
</div>
</div>
<div class="paragraph"><p>Franca IDL supports this kind of software structure by the keyword <em>manages</em>, which can be added to the keyword interface. The following example illustrates the application of this keyword.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">package</span></span> commonapi<span style="color: #990000">.</span>examples

<span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">E05Manager</span> <span style="color: #008080">manages</span> E05Device<span style="color: #990000">,</span> E05SpecialDevice <span style="color: #FF0000">{</span>
    version <span style="color: #FF0000">{</span> major <span style="color: #993399">1</span> minor <span style="color: #993399">0</span> <span style="color: #FF0000">}</span>

    <span style="color: #008080">attribute</span> String <span style="color: #990000">[]</span> myDevices

<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">E05Device</span> <span style="color: #FF0000">{</span>
    version <span style="color: #FF0000">{</span> major <span style="color: #993399">1</span> minor <span style="color: #993399">0</span> <span style="color: #FF0000">}</span>

    <span style="color: #008080">method</span> doSomething <span style="color: #FF0000">{</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">E05SpecialDevice</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> E05Device <span style="color: #FF0000">{</span>
    version <span style="color: #FF0000">{</span> major <span style="color: #993399">1</span> minor <span style="color: #993399">0</span> <span style="color: #FF0000">}</span>

    <span style="color: #008080">method</span> doSomethingSpecial <span style="color: #FF0000">{</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The device manager has the service interface E05Manager and it manages devices with the interfaces E05Device and E05SpecialDevice. It is important to understand, that the exact meaning of the keyword <code>manages</code> cannot be defined by the IDL; the keyword just indicates that there is a relationship between software components which implement manager and managed interfaces. It can be used in bindings as CommonAPI to provide API functions for a more convenient implementation of this certain kind of relationship.</p></div>
<div class="paragraph"><p>Therefore let&#8217;s have a look at the generated and implemented source code. Since we have three interfaces the code generator generates for every interface proxy and stub classes. In our example we just want to illuminate one aspect of the managed interfaces: the registration of the managed interfaces via the manager. We assume that we have only one service (the manager) which gets informed about a detected or a removed device via the public function deviceDetected and deviceRemoved. The devices are distinguished by a number; in principle there is an arbitrary number of devices possible. The registration of the devices at CommonAPI does the manager in his stub implementation.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">...</span> <span style="font-style: italic"><span style="color: #9A1900">// includes, namespaces, constructors as usual</span></span>

E05ManagerStubImpl<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">E05ManagerStubImpl</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> std<span style="color: #990000">::</span><span style="color: #008080">string</span> instanceName<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    managerInstanceName <span style="color: #990000">=</span> instanceName<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #009900">void</span> E05ManagerStubImpl<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">deviceDetected</span></span> <span style="color: #990000">(</span><span style="color: #009900">unsigned</span> <span style="color: #009900">int</span> n<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>

    std<span style="color: #990000">::</span><span style="color: #008080">string</span> deviceInstanceName <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">getDeviceName</span></span><span style="color: #990000">(</span>n<span style="color: #990000">);</span>
    myDevices<span style="color: #990000">[</span>deviceInstanceName<span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">DevicePtr</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">new</span></span> E05DeviceStubImpl<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">bool</span> deviceRegistered <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">registerManagedStubE05Device</span></span><span style="color: #990000">(</span>
        myDevices<span style="color: #990000">[</span>deviceInstanceName<span style="color: #990000">],</span> deviceInstanceName<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">void</span> E05ManagerStubImpl<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">deviceRemoved</span></span> <span style="color: #990000">(</span><span style="color: #009900">unsigned</span> <span style="color: #009900">int</span> n<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>

    std<span style="color: #990000">::</span><span style="color: #008080">string</span> deviceInstanceName <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">getDeviceName</span></span> <span style="color: #990000">(</span>n<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">bool</span> deviceDeregistered <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">deregisterManagedStubE05Device</span></span><span style="color: #990000">(</span>
        deviceInstanceName<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> deviceDeregistered <span style="color: #990000">)</span> <span style="color: #FF0000">{</span> myDevices<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">erase</span></span> <span style="color: #990000">(</span>deviceInstanceName<span style="color: #990000">);</span> <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

std<span style="color: #990000">::</span><span style="color: #008080">string</span> E05ManagerStubImpl<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">getDeviceName</span></span> <span style="color: #990000">(</span><span style="color: #009900">unsigned</span> <span style="color: #009900">int</span> n<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>

    std<span style="color: #990000">::</span><span style="color: #008080">stringstream</span> ss<span style="color: #990000">;</span>
    ss <span style="color: #990000">&lt;&lt;</span>  managerInstanceName <span style="color: #990000">&lt;&lt;</span>
        <span style="color: #FF0000">".device"</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">setw</span></span><span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">)</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>hex <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">setfill</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'0'</span><span style="color: #990000">)</span> <span style="color: #990000">&lt;&lt;</span> n<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> ss<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">str</span></span><span style="color: #990000">();</span>
<span style="color: #FF0000">}</span>

<span style="color: #990000">...</span> <span style="font-style: italic"><span style="color: #9A1900">// implementation of special device analogously</span></span></tt></pre></div></div>
<div class="paragraph"><p>The functions for the special device has been omitted for clarity.The implementations of the devices themselves are not important here as well. See now the implementation of the client. The client gets informed about new or removed devices including the addresses of these devices via the callback function newDeviceAvailable. This function can be subscribed as function object at an status event that is triggered when a device is added or removed.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;unistd.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;iostream&gt;</span>

<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;CommonAPI/CommonAPI.hpp&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;v1/commonapi/examples/E05ManagerProxy.hpp&gt;</span>

<span style="font-weight: bold"><span style="color: #0000FF">using</span></span> <span style="font-weight: bold"><span style="color: #0000FF">namespace</span></span> v1_0<span style="color: #990000">::</span>commonapi<span style="color: #990000">::</span>examples<span style="color: #990000">;</span>

<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">newDeviceAvailable</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> std<span style="color: #990000">::</span><span style="color: #008080">string</span> address<span style="color: #990000">,</span>
                    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> CommonAPI<span style="color: #990000">::</span><span style="color: #008080">AvailabilityStatus</span> status<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>

    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>status <span style="color: #990000">==</span> CommonAPI<span style="color: #990000">::</span>AvailabilityStatus<span style="color: #990000">::</span>AVAILABLE<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"New device available: "</span> <span style="color: #990000">&lt;&lt;</span> address <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>status <span style="color: #990000">==</span> CommonAPI<span style="color: #990000">::</span>AvailabilityStatus<span style="color: #990000">::</span>NOT_AVAILABLE<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Device removed: "</span> <span style="color: #990000">&lt;&lt;</span> address <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    CommonAPI<span style="color: #990000">::</span>Runtime<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">setProperty</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"LogContext"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"E05C"</span><span style="color: #990000">);</span>
    CommonAPI<span style="color: #990000">::</span>Runtime<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">setProperty</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"LibraryBase"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"E05Manager"</span><span style="color: #990000">);</span>

    std<span style="color: #990000">::</span><span style="color: #008080">shared_ptr&lt;CommonAPI::Runtime&gt;</span> runtime <span style="color: #990000">=</span> CommonAPI<span style="color: #990000">::</span>Runtime<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">();</span>

    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> std<span style="color: #990000">::</span><span style="color: #008080">string</span> <span style="color: #990000">&amp;</span>domain <span style="color: #990000">=</span> <span style="color: #FF0000">"local"</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> std<span style="color: #990000">::</span><span style="color: #008080">string</span> <span style="color: #990000">&amp;</span>instance <span style="color: #990000">=</span> <span style="color: #FF0000">"commonapi.examples.Manager"</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> std<span style="color: #990000">::</span><span style="color: #008080">string</span> connectionIdClient <span style="color: #990000">=</span> <span style="color: #FF0000">"client-sample"</span><span style="color: #990000">;</span>

    std<span style="color: #990000">::</span><span style="color: #008080">shared_ptr&lt;E05ManagerProxy&lt;&gt;&gt;</span> myProxy <span style="color: #990000">=</span> runtime<span style="color: #990000">-&gt;</span>buildProxy<span style="color: #990000">&lt;</span>E05ManagerProxy<span style="color: #990000">&gt;(</span>domain<span style="color: #990000">,</span> instance<span style="color: #990000">,</span> connectionIdClient<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(!</span>myProxy<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">isAvailable</span></span><span style="color: #990000">())</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>this_thread<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">sleep_for</span></span><span style="color: #990000">(</span>std<span style="color: #990000">::</span>chrono<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">microseconds</span></span><span style="color: #990000">(</span><span style="color: #993399">10</span><span style="color: #990000">));</span>
    <span style="color: #FF0000">}</span>

    std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Proxy available."</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>

    CommonAPI<span style="color: #990000">::</span>ProxyManager<span style="color: #990000">::</span>InstanceAvailabilityStatusChangedEvent<span style="color: #990000">&amp;</span> deviceEvent <span style="color: #990000">=</span>
                    myProxy<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getProxyManagerE05Device</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">getInstanceAvailabilityStatusChangedEvent</span></span><span style="color: #990000">();</span>
    CommonAPI<span style="color: #990000">::</span>ProxyManager<span style="color: #990000">::</span>InstanceAvailabilityStatusChangedEvent<span style="color: #990000">&amp;</span> specialDeviceEvent <span style="color: #990000">=</span>
                    myProxy<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getProxyManagerE05SpecialDevice</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">getInstanceAvailabilityStatusChangedEvent</span></span><span style="color: #990000">();</span>

    std<span style="color: #990000">::</span><span style="color: #008080">function&lt;void(const std::string, const CommonAPI::AvailabilityStatus)&gt;</span> newDeviceAvailableFunc <span style="color: #990000">=</span> newDeviceAvailable<span style="color: #990000">;</span>

    deviceEvent<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">subscribe</span></span><span style="color: #990000">(</span>newDeviceAvailableFunc<span style="color: #990000">);</span>
    specialDeviceEvent<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">subscribe</span></span><span style="color: #990000">(</span>newDeviceAvailableFunc<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>this_thread<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">sleep_for</span></span><span style="color: #990000">(</span>std<span style="color: #990000">::</span>chrono<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">seconds</span></span><span style="color: #990000">(</span><span style="color: #993399">5</span><span style="color: #990000">));</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_example_06_unions">Example 06: Unions</h3>
<div class="paragraph"><p>Until now, some simple and complex data types in the examples already occurred. This example intends to describe the use of unions closer and to compare it with the usage of polymorphic structs. Consider the following Franca IDL example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">package</span></span> commonapi<span style="color: #990000">.</span>examples

<span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">E06Unions</span> <span style="color: #FF0000">{</span>
    version <span style="color: #FF0000">{</span> major <span style="color: #993399">0</span> minor <span style="color: #993399">0</span> <span style="color: #FF0000">}</span>

    <span style="color: #008080">attribute</span> CommonTypes<span style="color: #990000">.</span>SettingsUnion u
    <span style="color: #008080">attribute</span> CommonTypes<span style="color: #990000">.</span>SettingsStruct x
<span style="color: #FF0000">}</span>

<span style="color: #008080">typeCollection</span> CommonTypes <span style="color: #FF0000">{</span>
    version <span style="color: #FF0000">{</span> major <span style="color: #993399">0</span> minor <span style="color: #993399">0</span> <span style="color: #FF0000">}</span>

    typedef MyTypedef is Int32

    <span style="color: #008080">enumeration</span> MyEnum <span style="color: #FF0000">{</span>
        DEFAULT
        ON
        OFF
    <span style="color: #FF0000">}</span>

    <span style="color: #008080">union</span> SettingsUnion <span style="color: #FF0000">{</span>
        MyTypedef id
        MyEnum status
        UInt8 channel
        String name
    <span style="color: #FF0000">}</span>

    struct <span style="color: #008080">SettingsStruct</span> polymorphic <span style="color: #FF0000">{</span>
    <span style="color: #FF0000">}</span>

    struct SettingsStructMyTypedef <span style="color: #008080">extends</span> SettingsStruct <span style="color: #FF0000">{</span>
        MyTypedef id
    <span style="color: #FF0000">}</span>

    struct SettingsStructMyEnum <span style="color: #008080">extends</span> SettingsStruct <span style="color: #FF0000">{</span>
        MyEnum status
    <span style="color: #FF0000">}</span>

    struct SettingsStructUInt8 <span style="color: #008080">extends</span> SettingsStruct <span style="color: #FF0000">{</span>
        UInt8 channel
    <span style="color: #FF0000">}</span>

    struct SettingsStructString <span style="color: #008080">extends</span> SettingsStruct <span style="color: #FF0000">{</span>
        String name
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>We first want to leave the question aside whether this example makes sense from an application point of view or not; it is just an example for demonstration purposes. With unions we can transmit data of different types in one attribute. These different types are enumerated in one structure with the keyword <code>union</code>. D-Bus knows a similar data type which is called variant. Variants are used in the D-Bus binding for the implementation of unions. The interesting point is here not the definition of the union, but the realization in CommonAPI. I just want to point out here that it can lead to problems with the compiler or generally to problems with your toolchain if you define unions with an significant number of members (eg. &gt;10), because each of these members appears in the generated C++ code as template argument in the template declaration.</p></div>
<div class="paragraph"><p>On the other hand we see the definition of a <code>polymorphic struct</code> which can lead to a similar but not the same behavior. The difference is that the types of the <code>polymorphic struct</code> definitions are extensions of a base type (here <code>SettingsStruct</code>), that means that they are inherited from this base type. The base type might contain some base elements which are then be inherited by the children. Another difference is, that the C++ API allows real polymorphic behavior. With Unions that is not possible, since there is no base type as we will see below.</p></div>
<div class="paragraph"><p>The implementation of the set function for the attribute u in the stub implementation could be as follows:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">void</span> E06UnionsStubImpl<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">setMyValue</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> n<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>

    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n <span style="color: #990000">&gt;=</span> <span style="color: #993399">0</span> <span style="color: #990000">&amp;&amp;</span> n <span style="color: #990000">&lt;</span> <span style="color: #993399">4</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>

        CommonTypes<span style="color: #990000">::</span><span style="color: #008080">MyTypedef</span> t0 <span style="color: #990000">=</span> <span style="color: #990000">-</span><span style="color: #993399">5</span><span style="color: #990000">;</span>
        CommonTypes<span style="color: #990000">::</span><span style="color: #008080">MyEnum</span> t1 <span style="color: #990000">=</span> CommonTypes<span style="color: #990000">::</span>MyEnum<span style="color: #990000">::</span>OFF<span style="color: #990000">;</span>
        <span style="color: #008080">uint8_t</span> t2 <span style="color: #990000">=</span> <span style="color: #993399">42</span><span style="color: #990000">;</span>
        std<span style="color: #990000">::</span><span style="color: #008080">string</span> t3 <span style="color: #990000">=</span> <span style="color: #FF0000">"∃y ∀x ¬(x ≺ y)"</span><span style="color: #990000">;</span>

        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            CommonTypes<span style="color: #990000">::</span><span style="color: #008080">SettingsUnion</span> <span style="font-weight: bold"><span style="color: #000000">v</span></span><span style="color: #990000">(</span>t0<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">setUAttribute</span></span><span style="color: #990000">(</span>v<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">setXAttribute</span></span><span style="color: #990000">(</span>std<span style="color: #990000">::</span>make_shared<span style="color: #990000">&lt;</span>CommonTypes<span style="color: #990000">::</span>SettingsStructMyTypedef<span style="color: #990000">&gt;(</span>t0<span style="color: #990000">));</span>
        <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n <span style="color: #990000">==</span> <span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            CommonTypes<span style="color: #990000">::</span><span style="color: #008080">SettingsUnion</span> <span style="font-weight: bold"><span style="color: #000000">v</span></span><span style="color: #990000">(</span>t1<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">setUAttribute</span></span><span style="color: #990000">(</span>v<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">setXAttribute</span></span><span style="color: #990000">(</span>std<span style="color: #990000">::</span>make_shared<span style="color: #990000">&lt;</span>CommonTypes<span style="color: #990000">::</span>SettingsStructMyEnum<span style="color: #990000">&gt;(</span>t1<span style="color: #990000">));</span>
        <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n <span style="color: #990000">==</span> <span style="color: #993399">2</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            CommonTypes<span style="color: #990000">::</span><span style="color: #008080">SettingsUnion</span> <span style="font-weight: bold"><span style="color: #000000">v</span></span><span style="color: #990000">(</span>t2<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">setUAttribute</span></span><span style="color: #990000">(</span>v<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">setXAttribute</span></span><span style="color: #990000">(</span>std<span style="color: #990000">::</span>make_shared<span style="color: #990000">&lt;</span>CommonTypes<span style="color: #990000">::</span>SettingsStructUInt8<span style="color: #990000">&gt;(</span>t2<span style="color: #990000">));</span>
        <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n <span style="color: #990000">==</span> <span style="color: #993399">3</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            CommonTypes<span style="color: #990000">::</span><span style="color: #008080">SettingsUnion</span> <span style="font-weight: bold"><span style="color: #000000">v</span></span><span style="color: #990000">(</span>t3<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">setUAttribute</span></span><span style="color: #990000">(</span>v<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">setXAttribute</span></span><span style="color: #990000">(</span>std<span style="color: #990000">::</span>make_shared<span style="color: #990000">&lt;</span>CommonTypes<span style="color: #990000">::</span>SettingsStructString<span style="color: #990000">&gt;(</span>t3<span style="color: #990000">));</span>
        <span style="color: #FF0000">}</span>

    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Type number "</span> <span style="color: #990000">&lt;&lt;</span> n <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">" not possible."</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Depending on a condition (here the value of n) the attributes u and x are filled with data of different types. Please note that the argument of <code>setUAttribute</code> has the type <code>CommonAPI::Variant&lt;MyTypedef, MyEnum, uint8_t, std::string&gt;</code>, whereas the argument of <code>setXAttribute</code> is a pointer to the base type <code>SettingsStruct</code>.</p></div>
<div class="paragraph"><p>The standard implementation on client side to get the value of the attribute uses the API call <code>isType</code> in case of the union attribute. First we have to subscribe; in the callback function it is possible to get the value of our attribute by checking the type which leads to an if / then / else cascade:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;unistd.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;iostream&gt;</span>

<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;CommonAPI/CommonAPI.hpp&gt;</span>

<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"../src-gen/commonapi/examples/CommonTypes.hpp"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"../src-gen/commonapi/examples/E06UnionsProxy.hpp"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"typeUtils.hpp"</span>

<span style="font-weight: bold"><span style="color: #0000FF">using</span></span> <span style="font-weight: bold"><span style="color: #0000FF">namespace</span></span> commonapi<span style="color: #990000">::</span>examples<span style="color: #990000">;</span>

<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">evalA</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> CommonTypes<span style="color: #990000">::</span>SettingsUnion<span style="color: #990000">&amp;</span> v<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>

    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> v<span style="color: #990000">.</span>isType<span style="color: #990000">&lt;</span>CommonTypes<span style="color: #990000">::</span>MyTypedef<span style="color: #990000">&gt;()</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received (A) MyTypedef with value "</span> <span style="color: #990000">&lt;&lt;</span>
            v<span style="color: #990000">.</span>get<span style="color: #990000">&lt;</span>CommonTypes<span style="color: #990000">::</span>MyTypedef<span style="color: #990000">&gt;()</span> <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">" at index "</span> <span style="color: #990000">&lt;&lt;</span>
            <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span>v<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getValueType</span></span><span style="color: #990000">()</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> v<span style="color: #990000">.</span>isType<span style="color: #990000">&lt;</span>CommonTypes<span style="color: #990000">::</span>MyEnum<span style="color: #990000">&gt;()</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received (A) MyEnum with value "</span> <span style="color: #990000">&lt;&lt;</span>
            <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span> <span style="color: #990000">(</span>v<span style="color: #990000">.</span>get<span style="color: #990000">&lt;</span>CommonTypes<span style="color: #990000">::</span>MyEnum<span style="color: #990000">&gt;())</span> <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">" at index "</span> <span style="color: #990000">&lt;&lt;</span>
            <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span>v<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getValueType</span></span><span style="color: #990000">()</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> v<span style="color: #990000">.</span>isType<span style="color: #990000">&lt;</span>uint8_t<span style="color: #990000">&gt;()</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received (A) uint8_t with value "</span> <span style="color: #990000">&lt;&lt;</span>
            <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span> <span style="color: #990000">(</span>v<span style="color: #990000">.</span>get<span style="color: #990000">&lt;</span>uint8_t<span style="color: #990000">&gt;())</span> <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">" at index "</span> <span style="color: #990000">&lt;&lt;</span>
            <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span>v<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getValueType</span></span><span style="color: #990000">()</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> v<span style="color: #990000">.</span>isType<span style="color: #990000">&lt;</span>std<span style="color: #990000">::</span>string<span style="color: #990000">&gt;()</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received (A) string "</span> <span style="color: #990000">&lt;&lt;</span> v<span style="color: #990000">.</span>get<span style="color: #990000">&lt;</span>std<span style="color: #990000">::</span>string<span style="color: #990000">&gt;()</span> <span style="color: #990000">&lt;&lt;</span>
            <span style="color: #FF0000">" at index "</span> <span style="color: #990000">&lt;&lt;</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span>v<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getValueType</span></span><span style="color: #990000">()</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received (A) change message with unknown type."</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">recv_msg</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> CommonTypes<span style="color: #990000">::</span>SettingsUnion<span style="color: #990000">&amp;</span> v<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">evalA</span></span><span style="color: #990000">(</span>v<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    std<span style="color: #990000">::</span><span style="color: #008080">shared_ptr&lt;CommonAPI::Runtime&gt;</span> runtime <span style="color: #990000">=</span> CommonAPI<span style="color: #990000">::</span>Runtime<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">();</span>

    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> std<span style="color: #990000">::</span><span style="color: #008080">string</span> <span style="color: #990000">&amp;</span>domain <span style="color: #990000">=</span> <span style="color: #FF0000">"local"</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> std<span style="color: #990000">::</span><span style="color: #008080">string</span> <span style="color: #990000">&amp;</span>instance <span style="color: #990000">=</span> <span style="color: #FF0000">"commonapi.examples.Unions"</span><span style="color: #990000">;</span>
    std<span style="color: #990000">::</span><span style="color: #008080">string</span> connection <span style="color: #990000">=</span> <span style="color: #FF0000">"client-sample"</span><span style="color: #990000">;</span>

    std<span style="color: #990000">::</span><span style="color: #008080">shared_ptr&lt;E06UnionsProxy&lt;&gt;&gt;</span> myProxy <span style="color: #990000">=</span> runtime<span style="color: #990000">-&gt;</span>buildProxy<span style="color: #990000">&lt;</span>E06UnionsProxy<span style="color: #990000">&gt;(</span>domain<span style="color: #990000">,</span> instance<span style="color: #990000">,</span> connection<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(!</span>myProxy<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">isAvailable</span></span><span style="color: #990000">())</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>this_thread<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">sleep_for</span></span><span style="color: #990000">(</span>std<span style="color: #990000">::</span>chrono<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">microseconds</span></span><span style="color: #990000">(</span><span style="color: #993399">10</span><span style="color: #990000">));</span>
    <span style="color: #FF0000">}</span>

    std<span style="color: #990000">::</span><span style="color: #008080">function&lt;void (CommonTypes::SettingsUnion)&gt;</span> f <span style="color: #990000">=</span> recv_msg<span style="color: #990000">;</span>
    myProxy<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getUAttribute</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">getChangedEvent</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">subscribe</span></span><span style="color: #990000">(</span>f<span style="color: #990000">);</span>

    std<span style="color: #990000">::</span><span style="color: #008080">function&lt;void (std::shared_ptr&lt;CommonTypes::SettingsStruct&gt;)&gt;</span> f1 <span style="color: #990000">=</span> recv_msg1<span style="color: #990000">;</span>
    myProxy<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getXAttribute</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">getChangedEvent</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">subscribe</span></span><span style="color: #990000">(</span>f1<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>this_thread<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">sleep_for</span></span><span style="color: #990000">(</span>std<span style="color: #990000">::</span>chrono<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">microseconds</span></span><span style="color: #990000">(</span><span style="color: #993399">10</span><span style="color: #990000">));</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The example shows, how it is possible to detect the type and the value of the received attribute. However, the if / then / else cascade is not the only, perhaps not the best way to get the value of the union on client side <span class="footnote"><br />[These two very good alternative implementations come from Martin Häfner from Harman. Thank you!]<br /></span>. One alternative implementation is based on an <code>typeIdOf</code> function, which is at the moment not part of CommonAPI but can be additionally implemented (see <code>typeUtils.hpp</code> of this example):</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;type_traits&gt;</span>

<span style="font-weight: bold"><span style="color: #0000FF">template</span></span> <span style="color: #990000">&lt;</span><span style="font-weight: bold"><span style="color: #0000FF">typename</span></span> <span style="color: #008080">SearchT</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">typename</span></span><span style="color: #990000">...</span> T<span style="color: #990000">&gt;</span>
<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">typeIdOf</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">template</span></span> <span style="color: #990000">&lt;</span><span style="font-weight: bold"><span style="color: #0000FF">typename</span></span> <span style="color: #008080">SearchT</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">typename</span></span> <span style="color: #008080">T</span><span style="color: #990000">&gt;</span>
<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">typeIdOf</span><span style="color: #990000">&lt;</span>SearchT<span style="color: #990000">,</span> T<span style="color: #990000">&gt;</span> <span style="color: #FF0000">{</span>

    <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">int</span> value <span style="color: #990000">=</span> std<span style="color: #990000">::</span>is_same<span style="color: #990000">&lt;</span>SearchT<span style="color: #990000">,</span> T<span style="color: #990000">&gt;::</span>value <span style="color: #990000">?</span> <span style="color: #993399">1</span> <span style="color: #990000">:</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">template</span></span> <span style="color: #990000">&lt;</span><span style="font-weight: bold"><span style="color: #0000FF">typename</span></span> <span style="color: #008080">SearchT</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">typename</span></span> <span style="color: #008080">T1</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">typename</span></span><span style="color: #990000">...</span> T<span style="color: #990000">&gt;</span>
<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">typeIdOf</span><span style="color: #990000">&lt;</span>SearchT<span style="color: #990000">,</span> T1<span style="color: #990000">,</span> T<span style="color: #990000">...&gt;</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">int</span> value <span style="color: #990000">=</span> std<span style="color: #990000">::</span>is_same<span style="color: #990000">&lt;</span>SearchT<span style="color: #990000">,</span> T1<span style="color: #990000">&gt;::</span>value <span style="color: #990000">?</span>
        <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">...(</span>T<span style="color: #990000">)+</span><span style="color: #993399">1</span> <span style="color: #990000">:</span> typeIdOf<span style="color: #990000">&lt;</span>SearchT<span style="color: #990000">,</span> T<span style="color: #990000">...&gt;::</span>value<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span></tt></pre></div></div>
<div class="paragraph"><p>The evaluation method (corresponding to <code>evalA</code> above) looks like:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">template</span></span> <span style="color: #990000">&lt;</span><span style="font-weight: bold"><span style="color: #0000FF">typename</span></span> <span style="color: #008080">T1</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">typename</span></span><span style="color: #990000">...</span> T<span style="color: #990000">&gt;</span>
<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">evalB</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> CommonAPI<span style="color: #990000">::</span>Variant<span style="color: #990000">&lt;</span>T1<span style="color: #990000">,</span> T<span style="color: #990000">...&gt;&amp;</span> v<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>

    <span style="font-weight: bold"><span style="color: #0000FF">switch</span></span> <span style="color: #990000">(</span>v<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getValueType</span></span><span style="color: #990000">())</span> <span style="color: #FF0000">{</span>

    <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> typeIdOf<span style="color: #990000">&lt;</span>CommonTypes<span style="color: #990000">::</span>MyTypedef<span style="color: #990000">,</span> T1<span style="color: #990000">,</span> T<span style="color: #990000">...&gt;::</span>value<span style="color: #990000">:</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received (B) MyTypedef with value "</span> <span style="color: #990000">&lt;&lt;</span>
            <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)(</span>v<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">template</span></span> get<span style="color: #990000">&lt;</span>CommonTypes<span style="color: #990000">::</span>MyTypedef<span style="color: #990000">&gt;())</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> typeIdOf<span style="color: #990000">&lt;</span>CommonTypes<span style="color: #990000">::</span>MyEnum<span style="color: #990000">,</span> T1<span style="color: #990000">,</span> T<span style="color: #990000">...&gt;::</span>value<span style="color: #990000">:</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received (B) MyEnum with value "</span> <span style="color: #990000">&lt;&lt;</span>
            <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)(</span>v<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">template</span></span> get<span style="color: #990000">&lt;</span>CommonTypes<span style="color: #990000">::</span>MyEnum<span style="color: #990000">&gt;())</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> typeIdOf<span style="color: #990000">&lt;</span>uint8_t<span style="color: #990000">,</span> T1<span style="color: #990000">,</span> T<span style="color: #990000">...&gt;::</span>value<span style="color: #990000">:</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received (B) uint8_t with value "</span> <span style="color: #990000">&lt;&lt;</span>
            <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)(</span>v<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">template</span></span> get<span style="color: #990000">&lt;</span>uint8_t<span style="color: #990000">&gt;())</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> typeIdOf<span style="color: #990000">&lt;</span>std<span style="color: #990000">::</span>string<span style="color: #990000">,</span> T1<span style="color: #990000">,</span> T<span style="color: #990000">...&gt;::</span>value<span style="color: #990000">:</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received (B) string "</span> <span style="color: #990000">&lt;&lt;</span>
            v<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">template</span></span> get<span style="color: #990000">&lt;</span>std<span style="color: #990000">::</span>string<span style="color: #990000">&gt;()</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">default</span></span><span style="color: #990000">:</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received (B) change message with unknown type."</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>One advantage here is that instead of the if / then / else statement a switch / case statement can be used.</p></div>
<div class="paragraph"><p>The second alternative implementation uses the function overloading. The overloaded functions are defined within a structure (<code>MyVisitor</code> in the example) that is used as a visitor in the evaluation function:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">MyVisitor</span> <span style="color: #FF0000">{</span>

    <span style="font-weight: bold"><span style="color: #0000FF">explicit</span></span> <span style="font-weight: bold"><span style="color: #0000FF">inline</span></span> <span style="font-weight: bold"><span style="color: #000000">MyVisitor</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">template</span></span><span style="color: #990000">&lt;</span><span style="font-weight: bold"><span style="color: #0000FF">typename</span></span><span style="color: #990000">...</span> T<span style="color: #990000">&gt;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">inline</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">eval</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> CommonAPI<span style="color: #990000">::</span>Variant<span style="color: #990000">&lt;</span>T<span style="color: #990000">...&gt;&amp;</span> v<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        CommonAPI<span style="color: #990000">::</span>ApplyVoidVisitor<span style="color: #990000">&lt;</span>MyVisitor<span style="color: #990000">,</span>
                CommonAPI<span style="color: #990000">::</span>Variant<span style="color: #990000">&lt;</span>T<span style="color: #990000">...&gt;,</span> T<span style="color: #990000">...&gt;::</span><span style="font-weight: bold"><span style="color: #000000">visit</span></span><span style="color: #990000">(*</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> v<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>

    <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #0000FF">operator</span></span><span style="color: #990000">()(</span>CommonTypes<span style="color: #990000">::</span><span style="color: #008080">MyTypedef</span> val<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received (C) MyTypedef with value "</span> <span style="color: #990000">&lt;&lt;</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span>val <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>

    <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #0000FF">operator</span></span><span style="color: #990000">()(</span>CommonTypes<span style="color: #990000">::</span><span style="color: #008080">MyEnum</span> val<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received (C) MyEnum with value "</span> <span style="color: #990000">&lt;&lt;</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span>val <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>

    <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #0000FF">operator</span></span><span style="color: #990000">()(</span><span style="color: #008080">uint8_t</span> val<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received (C) uint8_t with value "</span> <span style="color: #990000">&lt;&lt;</span> <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span>val <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>

    <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #0000FF">operator</span></span><span style="color: #990000">()(</span>std<span style="color: #990000">::</span><span style="color: #008080">string</span> val<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received (C) string "</span> <span style="color: #990000">&lt;&lt;</span> val <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">template</span></span><span style="color: #990000">&lt;</span><span style="font-weight: bold"><span style="color: #0000FF">typename</span></span> <span style="color: #008080">T</span><span style="color: #990000">&gt;</span>
    <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #0000FF">operator</span></span><span style="color: #990000">()(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> T<span style="color: #990000">&amp;)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received (C) change message with unknown type."</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>

    <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #0000FF">operator</span></span><span style="color: #990000">()()</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"NOOP."</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">evalC</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> CommonTypes<span style="color: #990000">::</span>SettingsUnion<span style="color: #990000">&amp;</span> v<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">MyVisitor</span> visitor<span style="color: #990000">;</span>
    visitor<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">eval</span></span><span style="color: #990000">(</span>v<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Finally, it should given here for comparison the implementation on the client side for the <code>polymorphic struct</code>. The subscription for a message receive function is identical to the previous implementation; the message receive function now looks as follows:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">recv_msg</span></span><span style="color: #990000">(</span>std<span style="color: #990000">::</span><span style="color: #008080">shared_ptr&lt;CommonTypes::SettingsStruct&gt;</span> x<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>

    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> std<span style="color: #990000">::</span><span style="color: #008080">shared_ptr&lt;CommonTypes::SettingsStructMyTypedef&gt;</span> sp <span style="color: #990000">=</span>
        std<span style="color: #990000">::</span>dynamic_pointer_cast<span style="color: #990000">&lt;</span>CommonTypes<span style="color: #990000">::</span>SettingsStructMyTypedef<span style="color: #990000">&gt;(</span>x<span style="color: #990000">)</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received (D) MyTypedef with value "</span> <span style="color: #990000">&lt;&lt;</span>
            <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span>sp<span style="color: #990000">-&gt;</span>id <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> std<span style="color: #990000">::</span><span style="color: #008080">shared_ptr&lt;CommonTypes::SettingsStructMyEnum&gt;</span> sp <span style="color: #990000">=</span>
        std<span style="color: #990000">::</span>dynamic_pointer_cast<span style="color: #990000">&lt;</span>CommonTypes<span style="color: #990000">::</span>SettingsStructMyEnum<span style="color: #990000">&gt;(</span>x<span style="color: #990000">)</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received (D) MyEnum with value "</span> <span style="color: #990000">&lt;&lt;</span>
            <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span>sp<span style="color: #990000">-&gt;</span>status <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> std<span style="color: #990000">::</span><span style="color: #008080">shared_ptr&lt;CommonTypes::SettingsStructUInt8&gt;</span> sp <span style="color: #990000">=</span>
        std<span style="color: #990000">::</span>dynamic_pointer_cast<span style="color: #990000">&lt;</span>CommonTypes<span style="color: #990000">::</span>SettingsStructUInt8<span style="color: #990000">&gt;(</span>x<span style="color: #990000">)</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received (D) uint8_t with value "</span> <span style="color: #990000">&lt;&lt;</span>
            <span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">)</span>sp<span style="color: #990000">-&gt;</span>channel <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span> std<span style="color: #990000">::</span><span style="color: #008080">shared_ptr&lt;CommonTypes::SettingsStructString&gt;</span> sp <span style="color: #990000">=</span>
        std<span style="color: #990000">::</span>dynamic_pointer_cast<span style="color: #990000">&lt;</span>CommonTypes<span style="color: #990000">::</span>SettingsStructString<span style="color: #990000">&gt;(</span>x<span style="color: #990000">)</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received (D) string "</span> <span style="color: #990000">&lt;&lt;</span> sp<span style="color: #990000">-&gt;</span>name <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Received (D) change message with unknown type."</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The result you get now by dynamic cast of the base type.</p></div>
</div>
<div class="sect2">
<h3 id="_example_07_mainloop">Example 07: Mainloop</h3>
<div class="paragraph"><p>This example shows how CommonAPI can be integrated with an external main loop. For demonstration purposes the <code>glib</code> main loop is used.</p></div>
<div class="paragraph"><p>CommonAPI does not contain a main loop implementation itself; just a demo implementation is provided for test purposes (please have a look to the verification tests in the CommonAPI tools project to find out how the demo main loop is used).</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contributor_8217_s_guide">Contributor&#8217;s Guide</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_preliminary_remarks_2">Preliminary Remarks</h3>
<div class="paragraph"><p>You can contribute as little or as much as you like: bug reports, patches or documentation are all equally appreciated:</p></div>
<div class="ulist"><ul>
<li>
<p>
Create bug reports for CommonAPI and bindings at <a href="http://bugs.genivi.org">http://bugs.genivi.org</a>, Product <em>Common API for IPC</em>
</p>
</li>
<li>
<p>
For the creation of patches: see chapter <em>Contribution of Code</em> below
</p>
</li>
<li>
<p>
Provide changes in the existing documentation or new documentations as patch or <em>asciidoc</em> document
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_build_tests_and_documentation">Build Tests and Documentation</h3>
<div class="paragraph"><p>There are additional make targets for contributors and developers:</p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="28%" />
<col width="71%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>make dist</code></p></td>
<td align="left" valign="top"><p class="table">Generates a packed tarball (*.tar.bz) from your current branch in your git repository.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>make doxygen-doc</code></p></td>
<td align="left" valign="top"><p class="table">Generates a packed tarball (*.tar.bz) from your current branch in your git repository.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>The CommonAPI documentation is written with <em>asciidoc</em> (<a href="http://www.methods.co.nz/asciidoc/">http://www.methods.co.nz/asciidoc/</a>). You will find the source of this user guide and the specification in the <em>docx</em> directory of the CommonAPI-Tools project. Please make sure that <em>asciidoc</em> is installed before you try to create the pdf- or html-files yourself. The documentation can be created by starting the Makefile in the <em>docx</em> directory. The doxygen output can be obtained by the make target <em>doxygen-doc</em>.</p></div>
<div class="paragraph"><p>Please note that CommonAPI itself does not contain any unit tests (only the source code of CommonAPI bindings might be delivered with unit tests). CommonAPI provides so-called verification tests which can be found in the ComonAPI Tools repository and there in the project <em>org.genivi.commonapi.core.verification</em>.</p></div>
<div class="paragraph"><p>The verification tests can be used to test features and the correct behavior of the CommonAPI framework together with the binding. These tests shall guarantee that CommonAPI and binding implement the CommonAPI specification and are stable.</p></div>
<div class="paragraph"><p>The verification tests are implemented by using <em>googletest</em> (<a href="http://code.google.com/p/googletest">http://code.google.com/p/googletest</a>). For compiling and running the tests <em>googletest</em> must be built and the configuration script location must be available in the environment variable <code>GTEST_CONFIG</code>.</p></div>
<div class="paragraph"><p>The first step is to create the glue code library. The term "glue code" refers to a binary that contains the binding specific generated code from the provided Franca files which you can find in <em>org.genivi.commonapi.core.verification/fidl</em>. The glue code library must contain the generated binding specific proxy and stub files. Please follow the instructions in your binding code for creating the glue code library.</p></div>
<div class="paragraph"><p>Now create a <em>build</em> directory in the verification project and start CMake.
The Following parameters can be applied:</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="40%" />
<col width="60%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>-DUSE_INSTALLED_COMMONAPI</code></p></td>
<td align="left" valign="top"><p class="table">OFF/ON</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-DTESTS_BAT</code></p></td>
<td align="left" valign="top"><p class="table">Set to ON to build a subset of tests covering basic functionality which
also have little execution time to serve as build acceptance tests</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-DTESTS_EXTRA</code></p></td>
<td align="left" valign="top"><p class="table">Set to ON to build extra tests for stability and performance testing</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-DCOMMONAPI_CMAKE_INSTALL_PATH</code></p></td>
<td align="left" valign="top"><p class="table">Path to the CommonAPI library</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-DCMAKE_GLUECODE_SOMEIP_NAME</code></p></td>
<td align="left" valign="top"><p class="table">Name of the someIP gluecode library (e.g. "SomeIPGlue" for "libSomeIPGlue.so")</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-DCMAKE_GLUECODE_DBUS_NAME</code></p></td>
<td align="left" valign="top"><p class="table">Name of the dbus gluecode library (e.g. "DBusGlue" for "libDBusGlue.so")</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-DSomeIPGlue_DIR</code></p></td>
<td align="left" valign="top"><p class="table">Path to the someIP gluecode library
(e.g. TOOLS_DIR/org.genivi.commonapi.someip.verification/build)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-DDBusGlue_DIR</code></p></td>
<td align="left" valign="top"><p class="table">Path to the dbus gluecode library
(e.g. DBUS_TOOLS_DIR/org.genivi.commonapi.dbus.verification/build)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-DCOMMONAPI_CMAKE_INSTALL_PATH</code></p></td>
<td align="left" valign="top"><p class="table">Path to the CommonAPI library</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-DCommonAPI_DIR</code></p></td>
<td align="left" valign="top"><p class="table">Path to CommonAPI</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-DCOMMONAPI_TOOL_GENERATOR</code></p></td>
<td align="left" valign="top"><p class="table">Path to the CommonAPI core generator executable</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>After that start <em>make -j4</em> and <em>ctest</em> to build and run the verification tests.</p></div>
</div>
<div class="sect2">
<h3 id="_formatting_code">Formatting Code</h3>
<div class="paragraph"><p>Use the Eclipse internal formatter <em>K&amp;R [built-in]</em> for formatting the code.</p></div>
</div>
<div class="sect2">
<h3 id="_contribution_of_code">Contribution of Code</h3>
<div class="paragraph"><p>First get the code from the git:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ git clone</code></pre>
</div></div>
<div class="paragraph"><p>Get an overview of all branches:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ git branch</code></pre>
</div></div>
<div class="paragraph"><p>Switch to the branch you want to work on (master is the feature branch) and verify that it has switched (* changed)</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ git checkout &lt;your branch&gt;
$ git branch</code></pre>
</div></div>
<div class="paragraph"><p>Best practice is to create a local branch based on the current branch:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ git branch working_branch</code></pre>
</div></div>
<div class="paragraph"><p>Start working, best practice is to commit smaller, compilable pieces during the development process that makes it easier to handle later on. If you want to commit you changes, send them to the author, you can create a patch like this:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ git format-patch working_branch &lt;your branch&gt;</code></pre>
</div></div>
<div class="paragraph"><p>This creates a set of patches that are published via the mailing list.The patches will be discussed and then merged &amp; uploaded on the git by the maintainer.</p></div>
<div class="paragraph"><p>Patches can be accepted either under GENIVI Cla or MPL 2.0 (see section License). Please be sure that the signed-off-by is set correctly. For more, check out <a href="http://gerrit.googlecode.com/svn/documentation/2.0/user-signedoffby.html">http://gerrit.googlecode.com/svn/documentation/2.0/user-signedoffby.html</a></p></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2022-05-13 14:03:10 CST
</div>
</div>
</body>
</html>
